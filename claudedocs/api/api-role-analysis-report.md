# 소상공인 창업 분석기 — API 역할 분석 보고서

> **작성일**: 2026-02-09
> **문서 목적**: 서비스에서 사용하는 모든 외부 API가 스코어링 모델과 AI 리포트에 어떻게 기여하는지 상세 분석

---

## 1. 전체 아키텍처 요약

사용자가 `주소 + 업종 + 반경`을 입력하면, 6개 외부 API를 병렬 호출하여 데이터를 수집하고,
**5대 지표 100점 만점** 종합 점수를 산출한 뒤, **Claude AI가 맞춤형 리포트**를 생성한다.

```
사용자 입력 (주소 + 업종 + 반경)
    │
    ▼
[Kakao API] 주소 → 좌표 → 법정동코드 (5자리)
    │
    ├──▶ [NPS API ×3] ─────────────────── 상권 활력도(30) + 경쟁 강도(25) + 생존율(20)
    ├──▶ [부동산 실거래 API] ──────────── 주거 밀도(15) + 소득 수준(10)
    ├──▶ [KOSIS API] ──────────────────── 주거 밀도 보정(인구/세대수)
    └──▶ [서울 골목상권 API ×3] ────────── 활력도 보정 + 생존율 보정 + AI 리포트 소재
              │
              ▼
         스코어링 엔진 (100점)
              │
              ▼
         [Claude AI] → 맞춤형 리포트
```

### 지표별 배점 및 API 매핑

| 지표 | 배점 | 1차 데이터 소스 | 보정 데이터 소스 |
|:-----|:----:|:---------------|:----------------|
| 상권 활력도 | **30점** | NPS (검색 + 상세 + 추이) | 서울 골목상권 (상권변화지표) |
| 경쟁 강도 | **25점** | NPS (검색) | — |
| 생존율 | **20점** | NPS (검색 — 가입상태) | 서울 골목상권 (점포 개폐업률) |
| 주거 밀도 | **15점** | 부동산 실거래 (거래 건수) | KOSIS (인구수 + 세대수) |
| 소득 수준 | **10점** | 부동산 실거래 (평균 거래가) | — |
| **합계** | **100점** | | |

---

## 2. API별 상세 분석

---

### 2.1 Kakao REST API — 지오코딩 (파이프라인 진입점)

| 항목 | 내용 |
|:-----|:-----|
| **역할** | 분석 파이프라인의 **진입점**. 주소를 좌표로, 좌표를 법정동코드로 변환 |
| **직접 기여 점수** | 없음 (0점). 다른 모든 API 호출의 **전제조건** |
| **클라이언트 파일** | `src/server/data-sources/kakao-geocoding.ts` |
| **환경변수** | `KAKAO_REST_API_KEY` |
| **없으면** | 강남구 역삼동 기본 좌표로 모킹 |

#### 사용하는 엔드포인트

| 엔드포인트 | 함수명 | 용도 | 호출 시점 |
|:-----------|:-------|:-----|:---------|
| `/v2/local/search/address.json` | `addressToCoord()` | 주소 → 좌표(위경도) | 클라이언트에서 주소 입력 시 |
| `/v2/local/geo/coord2regioncode.json` | `coordToRegion()` | 좌표 → 법정동코드 | `POST /api/analyze` 서버 처리 시 |
| `/v2/local/search/keyword.json` | `searchByKeyword()` | 키워드 장소 검색 | 지도 시각화 |

#### 데이터 흐름

```
사용자 입력: "서울 강남구 역삼동 123"
    │
    ▼ addressToCoord()
좌표: { latitude: 37.4979, longitude: 127.0276 }
    │
    ▼ coordToRegion()
법정동코드: "1168010100"
    │
    ├── districtCode: "11680" → NPS API (시도코드 "11" + 시군구코드 "680")
    ├── districtCode: "11680" → 부동산 API (LAWD_CD)
    ├── districtCode: "11680" → KOSIS API (objL1)
    └── "11"로 시작 → 서울 판별 → 골목상권 API 추가 호출
```

#### 이 API가 없으면

**전체 분석 파이프라인이 작동하지 않음.** NPS, 부동산, KOSIS 모두 법정동코드(5자리)가 필수 파라미터이기 때문.

#### 추가로 제공하지만 아직 활용하지 않는 데이터

| 데이터 | 설명 | 활용 가능성 |
|:-------|:-----|:-----------|
| `address_type` | 주소 유형 (지번/도로명) | 주소 정확도 표시 |
| `/v2/local/search/category.json` | 카테고리별 장소 검색 | 반경 내 편의시설(병원, 학교, 대중교통) 분석 |
| `/v2/local/geo/transcoord.json` | 좌표계 변환 | 다른 좌표계 API 연동 시 |

---

### 2.2 NPS 국민연금 사업장 API — 핵심 상권 데이터 (75점/100점)

| 항목 | 내용 |
|:-----|:-----|
| **역할** | 5대 지표 중 **3개(활력도 30 + 경쟁 25 + 생존율 20 = 75점)**의 1차 데이터 소스 |
| **직접 기여 점수** | **75점** (전체의 75%) |
| **클라이언트 파일** | `src/server/data-sources/nps-client.ts` |
| **환경변수** | `DATA_GO_KR_API_KEY` |
| **없으면** | mock JSON (`src/server/data-sources/mock/nps-*.json`) |
| **서버 특성** | data.go.kr 간헐적 502 → `fetchWithRetry` 최대 3회 재시도 |

#### 사용하는 엔드포인트 (3개)

| # | 엔드포인트 | 함수명 | 기여 지표 | 추출 데이터 |
|:-:|:-----------|:-------|:---------|:-----------|
| 1 | `getBassInfoSearchV2` | `searchBusinesses()` | 경쟁 강도 + 생존율 | 사업장 목록, 가입상태(`wkplJnngStcd`) |
| 2 | `getDetailInfoSearchV2` | `getBusinessDetail()` | 상권 활력도 | 직원수(`jnngpCnt`), 가입일(`adptDt`) |
| 3 | `getPdAcctoSttusInfoSearchV2` | `getMonthlyTrend()` | 상권 활력도 | 신규 가입자(`nwAcqzrCnt`), 퇴사자(`lssJnngpCnt`) |

#### 지표별 상세 기여

##### (A) 상권 활력도 — 30점 (NPS 검색 + 상세 + 추이)

상권이 살아있는지를 3가지 복합 지표로 측정한다.

| 하위 지표 | 가중치 | 산출 방법 | 사용 NPS 필드 |
|:----------|:------:|:---------|:-------------|
| 신규 창업 비율 | 30% | 최근 24개월 내 `adptDt`(가입일)를 가진 사업장 비율. 50% 이상이면 만점 | `adptDt` (상세) |
| 평균 직원 규모 | 40% | 활성 사업장의 평균 직원수. 20명 이상이면 만점 | `jnngpCnt` (상세) |
| 활성 비율 | 30% | 전체 대비 활성(`wkplJnngStcd === "1"`) 비율 | `wkplJnngStcd` (검색) |

```
활력도 = (신규창업비율 스코어 × 0.3) + (직원규모 스코어 × 0.4) + (활성비율 스코어 × 0.3)
       = 최대 30점
```

**해석 예시**:
- 28점: "주변 가게들이 활발하게 운영되고 직원도 늘고 있어요"
- 10점: "상권이 침체되어 있어요. 최근 2년간 새로 열린 가게가 거의 없어요"

##### (B) 경쟁 강도 — 25점 (NPS 검색, 역비례)

같은 업종이 얼마나 몰려있는지를 측정한다. **밀도가 낮을수록 높은 점수**(역비례).

```
밀도 = 동일 업종 사업장 수 / (π × 반경km²)
점수 = normalize(기준밀도×2 - 밀도, 0, 기준밀도×2, 25)
```

| 업종 | 기준 밀도 (개/km²) | 의미 |
|:-----|:-----------------:|:-----|
| 치킨전문점 (I56192) | 8 | 16개/km² 이상이면 0점 |
| 커피전문점 (I56191) | 15 | 30개/km² 이상이면 0점 |
| 한식음식점 (I56111) | 12 | 24개/km² 이상이면 0점 |
| 편의점 (G47112) | 5 | 10개/km² 이상이면 0점 |
| 기본값 | 10 | 20개/km² 이상이면 0점 |

**해석 예시**:
- 22점: "이 반경 내 동일 업종이 거의 없어요. 경쟁이 적어서 유리합니다"
- 5점: "이미 경쟁업체가 포화 상태예요"

##### (C) 생존율 — 20점 (NPS 검색)

같은 동네 같은 업종의 사업장이 얼마나 살아남았는지를 측정한다.

```
생존율 = 활성 사업장 수 / (활성 + 폐업)
점수 = normalize(생존율, 0.5, 0.9, 20)
  - 생존율 50% 이하 → 0점
  - 생존율 90% 이상 → 20점 (만점)
```

| NPS 가입상태 코드 | 의미 | 분류 |
|:-----------------|:-----|:-----|
| `wkplJnngStcd === "1"` | 국민연금 가입 중 | **활성** (active) |
| `wkplJnngStcd === "2"` | 국민연금 탈퇴 | **폐업** (closed) |

**해석 예시**:
- 18점: "이 동네 같은 업종 생존율이 85%로 높아요"
- 4점: "10곳 중 6곳이 문 닫았어요. 솔직히 좀 걱정되는 부분이에요"

#### 데이터 수집 흐름 (2단계 병렬)

```
1단계: searchBusinesses(regionCode, keyword)
       → 시군구 내 동일 업종 사업장 목록 (최대 100개)
       │
       ▼
2단계: 상위 20개 사업장에 대해 병렬 호출
       ├── getBusinessDetail(seq) × 20  → 직원수, 가입일
       └── getMonthlyTrend(seq, 12) × 20 → 최근 12개월 신규/퇴사
```

#### 추가로 제공하지만 아직 활용하지 않는 데이터

| 필드 | 설명 | 활용 가능성 |
|:-----|:-----|:-----------|
| `crrmmNtcAmt` | 당월 국민연금 고지금액 (원) | **추정 평균 급여** 산출 가능 (고지금액 ÷ 직원수 ÷ 요율 9%). 소득 수준 지표 보정 또는 "이 동네 평균 급여 수준" 리포트 제공 |
| `wkplIntpCd` | 업종코드 (세분류) | 업종 간 교차 분석 — "치킨집 옆에 편의점이 많은가?" 같은 상권 구성 분석 |
| `vldtVlKrnNm` | 업종명 (한글) | 업종 분류 정확도 향상 (키워드 매칭 대신 코드 기반 필터링) |
| `scsnDt` | 탈퇴일 (폐업일) | **폐업 시기 분석** — 계절별/연도별 폐업 패턴 도출, "최근 6개월 폐업 급증" 경고 |
| `wkplStylDvcd` | 사업장형태 (1=법인, 2=개인) | **법인 vs 개인 비율** — 프랜차이즈(법인) 밀집도 추정 |
| `ldongAddrMgplSgguEmdCd` | 읍면동 코드 | 더 세밀한 지역 필터링 (시군구 → 읍면동 단위) |
| 추이 데이터 전체 월별 | 12개월 각 월별 신규/퇴사 | 현재 첫 번째 항목만 사용 중. **월별 고용 추세 차트** 제공 가능 |

---

### 2.3 부동산 실거래 API — 구매력 + 주거 배후수요 (25점/100점)

| 항목 | 내용 |
|:-----|:-----|
| **역할** | **주거 밀도(15점)**와 **소득 수준(10점)** 산출의 1차 데이터 소스 |
| **직접 기여 점수** | **25점** (전체의 25%) |
| **클라이언트 파일** | `src/server/data-sources/real-estate-client.ts` |
| **환경변수** | `DATA_GO_KR_API_KEY` (NPS와 동일 키) |
| **응답 형식** | **XML** (JSON 미지원, 자체 정규식 파서 사용) |
| **없으면** | mock JSON (`src/server/data-sources/mock/real-estate.json`) |

#### 사용하는 엔드포인트

| 엔드포인트 | 함수명 | 추출 데이터 |
|:-----------|:-------|:-----------|
| `getRTMSDataSvcAptTradeDev` | `getApartmentTransactions()` | 아파트 매매 실거래 내역 |

**요청 파라미터**: `LAWD_CD`(법정동코드 5자리) + `DEAL_YMD`(거래년월, 현재 기준 3개월 전)

#### 지표별 상세 기여

##### (D) 주거 밀도 — 15점 (거래 건수 + KOSIS 보정)

아파트 거래 건수로 주거 배후 수요를 측정한다. KOSIS 데이터가 있으면 복합 지표로 보정.

```
KOSIS 없을 때:
  주거밀도 = normalize(거래건수, 10, 200, 15)

KOSIS 있을 때 (복합 지표):
  거래건수 점수 × 40% + 세대수 점수 × 35% + 인구수 점수 × 25%
  - 세대수: normalize(세대수, 5000, 150000, 15)
  - 인구수: normalize(인구수, 10000, 500000, 15)
```

**해석 예시**:
- 14점: "주변 배후 수요가 탄탄해요. 아파트 거래가 활발하고 세대수도 많아요"
- 3점: "주변 주거 인구가 적어요. 배달 장사라면 걱정이에요"

##### (E) 소득 수준 — 10점 (평균 거래가)

아파트 평균 거래가를 전국 평균(45,000만원)과 비교하여 지역 구매력을 추정한다.

```
비율 = 평균 거래가 / 전국 평균 (45,000만원)
점수 = normalize(비율, 0.5, 2.0, 10)
  - 전국 평균의 50% 이하 → 0점
  - 전국 평균의 200% 이상 → 10점 (만점)
```

**해석 예시**:
- 9점 (강남구, 평균 18억): "이 동네 구매력이 매우 높은 편이에요. 고가 메뉴 전략이 가능해요"
- 3점 (지방 소도시, 평균 1.5억): "구매력이 낮은 편이에요. 가성비 전략이 필요해요"

#### 추가로 제공하지만 아직 활용하지 않는 데이터

| 필드 | 설명 | 활용 가능성 |
|:-----|:-----|:-----------|
| `buildYear` | 건축년도 | **신축/구축 비율** — 재개발 가능성 판단, "이 동네는 신축이 많아 젊은 세대 유입 중" |
| `excluUseAr` | 전용면적 (m²) | **주거 유형 분석** — 소형(원룸/투룸) vs 대형 비율로 1인가구/가족 비율 추정 |
| `floor` | 층 | 참고 데이터 |
| `umdNm` | 법정동명 | 읍면동 단위 세분화 분석 |
| `dealDay` | 거래일 | **거래 추세** — 월초/월말 거래 패턴, 계절별 거래량 변동 |
| 복수 월 조회 | 현재 3개월 전 1개월만 조회 | **6~12개월 거래 추이** — 시세 상승/하락 트렌드, 거래량 변동 |

---

### 2.4 KOSIS 통계청 API — 인구/세대수 (주거 밀도 보정)

| 항목 | 내용 |
|:-----|:-----|
| **역할** | **주거 밀도(15점)** 보정 — 아파트 거래 건수만으로는 부족한 배후 인구 정보 보완 |
| **직접 기여 점수** | 주거 밀도 15점 중 **최대 60%** 보정 (세대수 35% + 인구수 25%) |
| **클라이언트 파일** | `src/server/data-sources/kosis-client.ts` |
| **환경변수** | `KOSIS_API_KEY` |
| **없으면** | mock JSON (`src/server/data-sources/mock/kosis-population.json`) |

#### 사용하는 통계표 (2개 병렬 조회)

| 통계표 ID | 통계표명 | 항목 | 추출 값 |
|:----------|:---------|:-----|:--------|
| `DT_1B040A3` | 행정구역(시군구)별 성별 인구수 | `T20` (총인구) | `totalPopulation` |
| `DT_1B040B3` | 행정구역(시군구)별 주민등록세대수 | `T1` (세대수) | `households` |

#### 보정 로직

KOSIS 데이터가 **없으면** 부동산 거래 건수 100%로 주거 밀도를 산출하고,
**있으면** 아래 복합 가중치로 보정한다:

```
주거 밀도 = (거래건수 점수 × 0.4) + (세대수 점수 × 0.35) + (인구수 점수 × 0.25)
```

| 데이터 | 하한 (0점) | 상한 (만점) | 가중치 |
|:-------|:----------|:----------|:------:|
| 아파트 거래 건수 | 10건 | 200건 | 40% |
| 세대수 | 5,000세대 | 150,000세대 | 35% |
| 인구수 | 10,000명 | 500,000명 | 25% |

#### 추가로 제공하지만 아직 활용하지 않는 데이터

KOSIS는 **1,000개 이상의 통계표**를 제공한다. 현재 2개만 사용 중.

| 통계표 | 설명 | 활용 가능성 |
|:-------|:-----|:-----------|
| `DT_1B040A3` 성별 데이터 | 남/여 인구 비율 | 업종별 타겟 성별과 매칭 (미용실→여성 비율, 포장마차→남성 비율) |
| `DT_1IN1502` | 연령별 인구 | **연령대별 인구 구성** — 20대 밀집 지역 vs 고령화 지역 판단 |
| `DT_1B04005N` | 인구 이동 (전입/전출) | **인구 유출입 추세** — 전입 > 전출이면 성장 지역 |
| `DT_1YL20631` | 사업체 조사 | 시군구별 사업체 수, 종사자 수 (NPS와 교차 검증) |
| `DT_1DA7002S` | 소득 분위별 데이터 | 지역별 **실제 소득 수준** (아파트 시세 기반 추정보다 정확) |

---

### 2.5 서울시 골목상권 API — 서울 한정 보정 + AI 리포트 소재

| 항목 | 내용 |
|:-----|:-----|
| **역할** | 서울 지역 한정으로 **활력도·생존율 보정** + AI 리포트에 매출/소비패턴 데이터 제공 |
| **직접 기여 점수** | 스코어 직접 변경 없음. **기존 지표를 보정** (활력도 +5~10%, 생존율 가중평균) |
| **클라이언트 파일** | `src/server/data-sources/seoul-golmok-client.ts` |
| **환경변수** | `SEOUL_OPEN_API_KEY` |
| **호출 조건** | `regionCode.startsWith("11")` (서울 시도코드) |
| **없으면** | mock JSON (`src/server/data-sources/mock/seoul-golmok-*.json`) |

#### 사용하는 엔드포인트 (3개)

| # | 서비스명 | 데이터 | 용도 |
|:-:|:---------|:-------|:-----|
| 1 | `VwsmTrdarSelngQq` | 추정매출 (분기) | AI 리포트: 월 예상 매출, 피크 시간/요일, 소비 연령/성별 |
| 2 | `VwsmTrdarStorQq` | 점포 현황 | 생존율 보정 (개업률/폐업률), AI 리포트: 프랜차이즈 비율 |
| 3 | `VwsmTrdarIxQq` | 상권변화지표 | 활력도 보정 (HH/HL/LH/LL 등급), AI 리포트: 상권 성격 |

#### 스코어링 보정 로직

##### 활력도 보정 (상권변화지표 기반)

```
상권변화지표 등급:
  HH (생존 높음 + 폐업 높음) → 활력도 × 1.05 (+5% 보너스) — 다이나믹한 상권
  LH (생존 낮음 + 폐업 높음) → 활력도 × 1.10 (+10% 보너스) — 신규 진입에 유리
  HL (생존 높음 + 폐업 낮음) → 보정 없음 — 기존 업체 강함, 진입장벽
  LL (생존 낮음 + 폐업 낮음) → 보정 없음 — 정체된 상권
```

##### 생존율 보정 (골목상권 폐업률 + NTS 기반 가중평균)

```
골목상권 생존율 = (100 - 폐업률%) / 100
보정된 생존율 = (NPS 기반 생존율 × 0.7) + (골목상권 생존율 × 0.3)
```

#### AI 리포트에 제공하는 데이터 (프롬프트에 주입)

| 데이터 | 프롬프트 표시 형식 | AI 활용 |
|:-------|:------------------|:--------|
| 분기 추정매출 | "분기 추정매출: 1,200만원" | "월 예상 매출 범위는 약 400만원이에요" |
| 피크 시간/요일 | "매출 피크: 금요일, 17~21시" | "금요일 저녁이 피크니까 주말 전 재고 확보를 하세요" |
| 평일/주말 비율 | "평일 65% / 주말 35%" | "평일 매출 비중이 높으니 오피스 점심 수요를 잡으세요" |
| 주 소비층 | "주 소비층: 30대 여성" | "30대 여성 타겟 메뉴 구성을 추천드려요" |
| 프랜차이즈 비율 | "프랜차이즈 12개 / 전체 20개" | "프랜차이즈 비율 60%... 개인 매장은 차별화 필수예요" |
| 상권변화지표 | "HH (다이나믹)" | "경쟁은 치열하지만 수요도 활발한 상권이에요" |
| 평균 영업기간 | "운영 사업체 평균 38.5개월" | "평균 3년 넘게 버티는 곳이니 장기 투자 마인드로 접근하세요" |

#### 추가로 제공하지만 아직 활용하지 않는 데이터

| 데이터 (API에서 제공) | 설명 | 활용 가능성 |
|:---------------------|:-----|:-----------|
| 요일별 매출 (7개) | 월~일 각 매출액 | 현재 "피크 요일"만 추출. **요일별 매출 차트** 제공 가능 |
| 시간대별 매출 (6개) | 00~06/06~11/11~14/14~17/17~21/21~24 | 현재 "피크 시간대"만 추출. **시간대별 매출 분포 차트** 제공 가능 |
| 연령대별 매출액/건수 (6개×2) | 10대~60대+ 각 매출액+건수 | 현재 "주 소비 연령대"만 추출. **연령대별 객단가** 분석 가능 |
| 성별 매출액/건수 (2×2) | 남/여 각 매출액+건수 | 현재 "주 소비 성별"만 추출. **성별 객단가 차이** 분석 가능 |
| `SIMILR_INDUTY_STOR_CO` | 유사업종 점포수 | AI 리포트에 전달되지만 프롬프트에서 깊게 활용 안 됨 |
| 개업/폐업 건수 (절대값) | `OPBIZ_STOR_CO`, `CLSBIZ_STOR_CO` | 비율만 사용 중. **절대 건수로 신규 개업 트렌드** 파악 가능 |

---

### 2.6 Anthropic Claude API — AI 리포트 생성

| 항목 | 내용 |
|:-----|:-----|
| **역할** | 수집된 모든 데이터를 종합하여 **자연어 분석 리포트** 생성 |
| **직접 기여 점수** | 스코어링에 관여 없음. 점수 산출 **이후** 단계 |
| **모델** | `claude-haiku-4-5-20251001` |
| **파일** | `src/features/report/actions.ts` + `src/features/report/lib/prompt-builder.ts` |
| **환경변수** | `ANTHROPIC_API_KEY` |
| **없으면** | AI 리포트 기능 비활성화 (분석 결과는 점수만 표시) |

#### AI가 받는 데이터 (프롬프트 구성)

| 섹션 | 데이터 소스 | 내용 |
|:-----|:-----------|:-----|
| 분석 대상 | 사용자 입력 | 위치, 업종, 반경 |
| 상권 현황 | NPS | 사업장 수, 활성/휴업/폐업 수, 생존율 |
| 종합 스코어 | 스코어링 엔진 | 총점 + 5개 지표별 등급(A~F) + 퍼센트 |
| 부동산 시세 | 부동산 API | 평균 거래가, 거래 건수 |
| 인구 현황 | KOSIS | 총 인구, 세대수 (있을 때만) |
| 골목상권 분석 | 서울 골목상권 | 추정매출, 피크, 소비층, 점포, 변화지표 (서울만) |

#### AI 리포트 출력 구조

```json
{
  "verdict": "추천 | 조건부 추천 | 주의 | 비추천",
  "summary": "한 줄 종합 판단 (50자 이내)",
  "strengths": ["강점 1", "강점 2", "강점 3"],
  "risks": ["위험 1", "위험 2", "위험 3"],
  "recommendations": ["실행 가능한 구체적 제언 1", "제언 2", "제언 3"],
  "detailedAnalysis": "3~5문단 상세 분석 (마크다운)"
}
```

---

## 3. API 간 의존성 및 호출 순서

```
[직렬] Kakao 지오코딩 (필수 선행)
    │
    ▼ 법정동코드 획득
    │
[병렬 1단계]
    ├── NPS 사업장 검색 ──────── (regionCode + keyword)
    ├── 부동산 실거래 ──────────── (LAWD_CD + DEAL_YMD)
    ├── KOSIS 인구 (2개 테이블) ── (districtCode)
    └── 서울 골목상권 (3개, 서울만) ── (industryKeyword)
    │
    ▼ NPS 검색 결과에서 상위 20개 seq 추출
    │
[병렬 2단계]
    ├── NPS 상세 × 20
    └── NPS 추이 × 20
    │
    ▼ 모든 데이터 수집 완료
    │
[직렬] 스코어링 엔진 → DB 저장
    │
[직렬] Claude AI 리포트 (사용자 요청 시)
```

**총 API 호출 수** (서울 지역 기준, 최대):
- Kakao: 1회
- NPS: 1 + 20 + 20 = **41회**
- 부동산: **1회**
- KOSIS: **2회**
- 서울 골목상권: **3회**
- Claude: **1회**
- **합계: 최대 49회** (Redis 캐시 미스 시)

---

## 4. 에러 격리 전략

| 실패 API | 영향 범위 | 대응 |
|:---------|:---------|:-----|
| **Kakao** | 전체 분석 불가 | 분석 상태 FAILED 처리 |
| **NPS 검색** | 활력도(30) + 경쟁(25) + 생존율(20) = 75점 손실 | `Promise.allSettled`로 격리, 빈 배열로 처리 |
| **NPS 상세/추이** | 개별 사업장 직원수/추이 누락 | 해당 사업장만 `employeeCount: 0` |
| **부동산** | 주거밀도(15) + 소득(10) = 25점 손실 | 빈 배열 → 기본값(중간 점수) |
| **KOSIS** | 주거밀도 보정 불가 (거래건수 100% 의존) | `population: undefined` → 단일 지표 모드 |
| **서울 골목상권** | 스코어 보정 + AI 리포트 소재 누락 | `golmok: undefined` → 보정 스킵 |
| **Claude** | AI 리포트 없음 (점수만 표시) | 사용자에게 에러 메시지 반환 |

---

## 5. 미활용 데이터 기반 확장 가능성 (요약)

| 우선순위 | 확장 기능 | 필요 데이터 | 현재 상태 |
|:--------:|:---------|:-----------|:---------|
| 🔴 높음 | **추정 평균 급여** (소득 수준 보정) | NPS `crrmmNtcAmt` | 필드는 수집되지만 미사용 |
| 🔴 높음 | **폐업 시기 분석** (최근 급증 경고) | NPS `scsnDt` | 필드 정의만 있고 미사용 |
| 🟡 중간 | **월별 고용 추세 차트** | NPS 추이 전체 월별 데이터 | 현재 첫 항목만 사용 |
| 🟡 중간 | **시간대/요일별 매출 차트** (서울) | 골목상권 매출 세부 필드 | 피크만 추출, 전체 분포 미사용 |
| 🟡 중간 | **연령대별 객단가** (서울) | 골목상권 연령대별 매출액+건수 | 주 소비 연령대만 추출 |
| 🟢 낮음 | **인구 유출입 추세** | KOSIS 인구이동 테이블 | 미연동 |
| 🟢 낮음 | **전용면적별 주거 유형** | 부동산 `excluUseAr` | 미사용 |
| 🟢 낮음 | **법인/개인 비율** | NPS `wkplStylDvcd` | 미사용 |

---

## 6. NTS 사업자 상태 API — 미구현 (PRD에는 정의됨)

PRD에서는 NTS(국세청) API로 실시간 영업/휴업/폐업 상태를 확인하도록 설계했으나,
현재 구현에서는 **NPS의 가입상태(`wkplJnngStcd`)로 대체**하고 있다.

| 항목 | PRD 설계 | 현재 구현 |
|:-----|:---------|:---------|
| 사업자 상태 확인 | NTS MCP `check_business_status` | NPS `wkplJnngStcd` (1=가입, 2=탈퇴) |
| 데이터 정확도 | 실시간 (국세청 원본) | 월 단위 (국민연금 갱신 주기) |
| 휴업 구분 | 가능 (영업/휴업/폐업 3상태) | 불가 (가입/탈퇴 2상태만) |
| 구현 파일 | `nts-client.ts` 없음 | NPS로 대체 |

**NTS 구현 시 기대 효과**: 생존율 정확도 향상 (현재 NPS 탈퇴 = 폐업으로 간주하지만, 실제로는 업종 전환이나 이전일 수 있음)
