# 소상공인 창업 분석기 (Small Business Startup Analyzer)
## Phase 2 Mobile UX 제품 요구사항 문서 (PRD)

---

## 📋 문서 정보 (Document Information)

| 항목 | 내용 |
|------|------|
| **문서명** | Phase 2 Mobile UX PRD |
| **버전** | v2.0.0 |
| **작성일** | 2026년 2월 9일 |
| **최종 수정일** | 2026년 2월 9일 |
| **상태** | 🟢 최종 검토 완료 (Final Review Complete) |
| **담당자** | Product Team |
| **대상 플랫폼** | Mobile (iOS 12+, Android 8+) + Responsive Web |
| **개발 예상 기간** | 8주 |

---

## 📌 Executive Summary

### Phase 2 비전: 모바일-퍼스트 대화형 UX 혁신

**"창업자의 손가락 끝에서 시작되는 사업 입지 분석"**

Phase 1은 데스크톱 중심의 기능 완성에 집중했다면, Phase 2는 **모바일 환경에서의 직관적이고 자연스러운 사용자 경험**을 핵심으로 합니다.

#### 핵심 변화:
- 🗺️ **지도 중심 UX**: 검색 기반 → 지도 기반 인터랙션으로 패러다임 전환
- 💬 **대화형 온보딩**: 단계별 안내를 통한 친근한 사용자 경험
- 🎯 **직관적 제스처**: 스와이프, 핀치 등 모바일 네이티브 인터랙션 활용
- ⚡ **실시간 피드백**: 반경 변경 시 즉시 경쟁업체 업데이트
- 📊 **프로그레시브 공개**: 필요한 정보를 단계적으로 제공

**목표 사용자**: 모바일로 창업 입지를 빠르게 검토하고 싶은 30-50대 소상공인 및 예비 창업자

---

## 🔍 Phase 1 회고 (Phase 1 Retrospective)

### Phase 1의 성과 ✅

| 항목 | 결과 |
|------|------|
| **MVP 완성** | 상권건강도, 경쟁강도, 입지적합성, AI리포트 4가지 핵심 기능 구현 |
| **데이터 파이프라인** | NPS MCP, NTS MCP, KOSIS, Seoul Golmok API 연동 완료 |
| **기술 스택** | Next.js + TypeScript + Tailwind CSS로 안정적 구축 |
| **Kakao Map 통합** | 지도 시각화 및 경쟁업체 표시 구현 |
| **점수 산식** | 5가지 지표로 정교한 점수 계산 시스템 구현 |

### Phase 1의 한계점 ⚠️

| 한계 | 영향 | 이유 |
|------|------|------|
| 데스크톱 사이드바 중심 내비게이션 | 모바일에서 레이아웃 복잡함 | 그리드 기반 레이아웃이 작은 화면에 비효율적 |
| 다단계 폼 기입 (주소 → 업종 → 반경) | 입력 피로도 높음 | 모바일 키보드 반복 사용, 명확한 진행 상태 부족 |
| 지도는 결과 페이지의 하나의 탭 | 공간 활용 비효율 | 지도를 통한 직관적 검색 불가능 |
| 제스처 미지원 | 네이티브 앱 경험 부족 | 스와이프, 핀치, 드래그 등 자연스러운 상호작용 없음 |
| 반경 조정 후 재검색 필요 | UX 흐름 끊김 | 실시간 업데이트 부족, 수동 재검색 필요 |
| 모바일 화면 최적화 부족 | 가독성, 터치 영역 문제 | 51% 이상 사용자가 모바일 환경에서 접속 |

### Phase 1→2 전환 이유

```
데스크톱-퍼스트
(2024년 설계)
    ↓
    └─ 초기 유저 피드백:
       "모바일로 외출 중에 쓰고 싶은데..."
       "지도에서 직접 반경을 조절하고 싶어"
       "너무 많은 단계를 거쳐야 하는 게 번거로워"
    ↓
모바일-퍼스트
(Phase 2 목표)
    └─ 지도 기반 → 직관적 검색
       → 반경 제스처 조정 → 실시간 업데이트
       → 자연스러운 결과 전환
```

---

## 🎨 디자인 원칙 (Design Principles)

### 1. 모바일-퍼스트 (Mobile-First)
- **최상의 모바일 경험**: 350px~480px 화면부터 완벽 동작
- **터치 최적화**: 모든 인터랙티브 요소 최소 44px×44px
- **성능 우선**: 초기 로딩 3초 이내, 반경 업데이트 500ms 이내

### 2. 대화형 UI (Conversational UI)
- **친근한 톤**: 이모지와 따뜻한 문구로 사용자 안내
- **단계별 진행**: 한 번에 하나의 작업에만 집중
- **즉시 피드백**: 모든 액션에 대한 즉각적인 시각적 응답

### 3. 프로그레시브 공개 (Progressive Disclosure)
- **필수 정보만**: 각 단계에서 필요한 최소 정보만 제시
- **점진적 복잡도 증가**: 사용자가 준비되면 고급 기능 노출
- **맥락 기반 안내**: 이전 단계의 선택이 다음 UI에 반영

### 4. 자연스러운 흐름 (Natural Flow)
- **지도 중심**: 위치 검색부터 반경 설정까지 지도 인터랙션으로 연결
- **애니메이션**: 단계 전환 시 부드러운 전환 효과로 연속성 강조
- **맥락 기억**: 사용자의 선택과 입력 자동 저장

### 5. 시각적 명확성 (Visual Clarity)
- **강한 대비**: CTA 버튼, 선택된 영역 명확한 구분
- **의도적 공백**: 중요한 요소에 시각적 집중 유도
- **한눈에 이해**: 복잡한 정보도 인포그래픽으로 간단히 표현

### 6. 접근성 (Accessibility)
- **색상 의존 배제**: 아이콘, 라벨로 정보 전달
- **고대비 모드**: 야외 강한 햇빛 환경에서도 가독성 확보
- **음성 가이드**: 스크린리더 완전 지원

---

## 🔄 상세 User Flow

### 전체 Flow 다이어그램

```
[Step 1] 환영 화면
    ↓  스와이프 업 → 지도가 드러남
[Step 3] 전체화면 지도 + 위치 검색 (바텀시트)
    ↓  위치 선택 → 바텀시트가 업종 검색으로 전환
[Step 4] 위치 확정 + 업종 검색/선택 (바텀시트)
    ↓  업종 선택 → 반경 원 표시 + 바텀시트 전환
[Step 5] 반경 직접 조절 + 실시간 경쟁업체 (지도 원 드래그)
    ↓  "분석 시작하기" 탭
[Step 6~7] AI 실시간 분석 (타이핑 효과)
    ├─ Phase A: 무료 기본 분석 (점수 + 3개 지표 + AI 요약)
    ├─ Phase B: 블러 게이트 → 프리미엄 전환 유도
    ├─ [무료] 기본 결과만 확인
    └─ [유료] 블러 해제 → AI 타이핑 계속 → 상세 리포트 완성
         ↓
[Step 8] AI 리포트 전체 확인 + PDF 다운로드
    ↓
[완료] 결과 저장 / 새 분석 / 공유
```

> **핵심 UX 원칙**: 모든 단계에서 지도가 풀스크린으로 유지되며, 상단 헤더 없음.
> 모든 UI는 바텀시트로 제공되고, 스와이프 업/다운으로 조작합니다.
> 분석 결과는 AI가 실시간으로 작성하는 느낌을 주며, 무료→유료 전환이 자연스럽게 흘러갑니다.

---

### 📱 Step 1: 대화형 온보딩 화면 (Conversational Onboarding)

#### 목표
사용자를 따뜻하게 맞이하고 다음 단계로 자연스럽게 유도

#### 화면 구성

```
┌─────────────────────────────┐
│                             │
│    [로고 또는 블랜디드 배경] │
│                             │
│                             │
│    ✨ 창업을 준비중이신가요? ✨ │
│                             │
│  저와 함께 창업 하시려는곳이   │
│  괜찮은지 시작해볼까요? 😊    │
│                             │
│                             │
│                             │
│                             │
│          ∧  ∧  ∧            │
│         ↑ 밀어서 시작        │
│    ─ ─ ─ ─ ─ ─ ─ ─ ─ ─    │
└─────────────────────────────┘
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **배경** | 그라데이션 (주색상 → 보조색상), 또는 반투명 카카오맵 블렌드 (다음 화면 티저) |
| **인사 텍스트** | 크기 28px, 볼드, 중앙 정렬, 줄 간격 1.5 |
| **이모지** | 각 행에 적절한 이모지 삽입 (✨ 😊 등) |
| **스와이프 인디케이터** | 하단 중앙, 화살표(∧) 반복 애니메이션 + "밀어서 시작" 텍스트 14px |
| **인디케이터 색상** | 흰색 60% 투명도 → 100% 반복 (breathing 효과) |
| **스와이프 힌트 라인** | 하단 8px, 폭 134px, 둥근 모서리, iOS 홈 인디케이터 스타일 |

#### 인터랙션

- **로드 애니메이션**: 텍스트가 위에서 순차적으로 페이드인 (0.4초)
- **스와이프 힌트**: 화살표가 위아래로 부드럽게 바운스 (1.5초 주기, 무한 반복)
- **스와이프 업 제스처**: 하단에서 위로 50px 이상 스와이프 시 트리거
  - 스와이프 진행에 따라 배경이 점점 위로 밀려남 (parallax)
  - 뒤에서 지도 화면이 서서히 드러남 (peek 효과)
- **스와이프 완료**: Haptic feedback (medium) → Step 3 지도 화면 전체 노출
- **폴백**: 화면 탭해도 동일하게 동작 (접근성 보장)

#### 애니메이션 타이밍

```javascript
// 의사 코드
onMount: {
  텍스트1 fadeIn 0~400ms
  텍스트2 fadeIn 200~600ms
  스와이프힌트 fadeIn 600~1000ms
  스와이프힌트 bounceY infinite 1500ms  // 위아래 8px 바운스
}

onSwipeUp(progress): {  // progress: 0~1
  온보딩화면 translateY(-progress * 100%)
  지도화면 opacity(progress)  // 뒤에서 서서히 드러남
  if (progress > 0.3) haptic(light)
}

onSwipeComplete: {
  haptic(medium)
  온보딩화면 slideOut 300ms ease-out
  → Step 3 지도 화면 진입 (Step 2 생략, 직행)
}
```

---

> **Note**: 기존 Step 2 (CTA 버튼 인터랙션)는 스와이프 업 제스처로 통합되어 삭제됨.
> Step 1에서 스와이프 완료 시 Step 3(지도)으로 직행합니다.

---

### 🗺️ Step 3: 전체화면 지도 + 위치 검색 오버레이

#### 목표
사용자가 원하는 창업 위치를 직관적으로 검색하고 선택

#### 화면 구성

```
┌─────────────────────────────────────┐
│                                     │
│                                     │
│                                     │
│      [전체 화면 Kakao Map]         │
│      (사용자 현위치 중심)          │
│                                     │
│                                     │
│                        [◎ 현위치]  │
│                                     │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│  ─── 드래그 핸들 ───              │
│ 🔍 어디서 창업하실 건가요?         │
│     (탭하여 검색)                  │
└─────────────────────────────────────┘

        ↕ 스와이프 업 시 확장:

┌─────────────────────────────────────┐
│  [지도 상단 일부만 보임]           │
├─────────────────────────────────────┤
│  ─── 드래그 핸들 ───              │
│                                     │
│ ┌───────────────────────────────┐  │
│ │ 🔍 주소, 건물명, 역 이름 검색  │  │
│ └───────────────────────────────┘  │
│                                     │
│ 📍 최근 검색                       │
│ ┌───────────────────────────────┐  │
│ │  강남역, 강남구               │  │
│ │  홍대 카페거리                │  │
│ │  잠실 송파구                  │  │
│ └───────────────────────────────┘  │
│                                     │
│ 🔥 인기 창업 지역                  │
│ ┌───────────────────────────────┐  │
│ │  성수동  │  망원동  │  연남동  │  │
│ └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **지도** | Kakao Map SDK, 초기 확대 레벨 15, 사용자 현위치 자동 중심 |
| **현위치 버튼** | 지도 우측 하단, 40×40px, 지도 위 플로팅 |
| **바텀시트 (축소)** | 높이 ~100px, 검색 힌트 텍스트 + 드래그 핸들만 노출 |
| **바텀시트 (확장)** | 높이 화면의 65%, 검색 입력 + 최근 검색 + 인기 지역 |
| **드래그 핸들** | 상단 중앙, 4px × 40px, #D1D5DB |
| **검색 입력** | 높이 44px, 아이콘 + placeholder, 포커스 시 키보드 올라옴 |
| **최근 검색** | 최대 5개, 각 항목 높이 48px, 스와이프 좌측 삭제 |
| **인기 창업 지역** | 가로 스크롤 칩, 각 칩 패딩 12px 16px |
| **뒤로가기** | 없음 (스와이프 다운으로 Step 1 복귀 가능) |

#### 맵 마크업

```
지도 마커:
- 파란 점: 사용자 현위치 (GPS)
- 빨간 핀: 검색으로 선택한 위치
- 선택 마커: 핀 드롭 애니메이션 + 펄스 효과
```

#### 인터랙션

**바텀시트 스와이프:**
- 축소 상태에서 스와이프 업 → 확장 (검색 UI 전체 노출)
- 확장 상태에서 스와이프 다운 → 축소 (지도 전체 보기)
- 축소 상태의 검색 힌트 텍스트 탭해도 확장 트리거

**검색 입력:**
- 바텀시트 확장 시 검색 필드 자동 포커스 + 키보드 올라옴
- 입력 시 실시간 자동완성 (Kakao Geocoding API, 200ms 디바운싱)
- 결과 최대 10개, 각 결과 탭 → 바텀시트 축소 + 지도 이동

**최근 검색 / 인기 지역:**
- 각 항목 탭 → 바텀시트 축소 + 지도 해당 위치로 이동
- 최근 검색 스와이프 좌측 → 삭제

**지도 직접 인터랙션:**
- 지도 롱프레스 (1초) → 해당 위치에 핀 드롭 (주소 검색 없이 직접 선택)
- 핀치 줌, 드래그 이동 자유

---

### 📍 Step 4: 위치 확정 + 업종 선택

#### 목표
선택한 위치를 확인하고, 공공 API 업종코드 기반으로 업종을 검색/선택하여 다음 단계로 연결

#### 업종코드 체계 참고

공공 API에 전송하는 업종코드는 사전에 정의된 코드만 사용 가능합니다.

```
업종코드 예시 (서울 골목상권 SVC_INDUTY_CD):
CS100001  한식음식점
CS100002  중식음식점
CS100003  일식음식점
CS100006  치킨전문점
CS100010  커피-Loss/카페
CS200001  일반의류
CS200002  패스트푸드점
CS300001  일반의원
CS300002  치과의원
CS300009  미용실
...

NPS MCP 업종 분류: 표준산업분류코드 (KSIC) 기반
```

> 앱 초기 로드 시 API에서 전체 업종코드 목록을 가져와 로컬 캐싱합니다.

#### 화면 구성

```
┌─────────────────────────────────────┐
│                                     │
│                                     │
│      [전체 화면 Kakao Map]         │
│      (선택 위치 중심, 핀 마커)     │
│                                     │
│                        [◎ 현위치]  │
│                                     │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│  ─── 드래그 핸들 ───              │
│                                     │
│  📍 서울 강남구 역삼동 강남역      │
│     (탭하여 위치 변경)             │
│                                     │
│  🔍 업종을 검색해주세요            │
│     (예: 치킨, 카페, 미용실)       │
│                                     │
└─────────────────────────────────────┘

        ↕ 스와이프 업 또는 검색 탭 시 확장:

┌─────────────────────────────────────┐
│  [지도 상단 일부만 보임]           │
├─────────────────────────────────────┤
│  ─── 드래그 핸들 ───              │
│                                     │
│  📍 서울 강남구 역삼동 강남역      │
│                                     │
│ ┌───────────────────────────────┐  │
│ │ 🔍 치킨                    ✕  │  │
│ └───────────────────────────────┘  │
│                                     │
│ 검색 결과:                         │
│ ┌───────────────────────────────┐  │
│ │ 🍗 치킨전문점    CS100006    │  │
│ ├───────────────────────────────┤  │
│ │ 🍗 한식/치킨     CS100012    │  │
│ └───────────────────────────────┘  │
│                                     │
│ 최근 선택:                         │
│ ┌────────────┐ ┌────────────┐     │
│ │ 치킨전문점  │ │ 커피/카페  │     │
│ └────────────┘ └────────────┘     │
│                                     │
└─────────────────────────────────────┘
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **지도** | 전체 화면, 선택 위치에 핀 마커 + 펄스 애니메이션 |
| **바텀시트 (축소)** | 높이 ~160px, 주소 + 업종 검색 힌트 |
| **바텀시트 (확장)** | 높이 화면 65%, 검색 입력 + 결과 목록 + 최근 선택 |
| **주소 텍스트** | 16px, 굵음, 탭 시 Step 3으로 복귀 (위치 재검색) |
| **검색 입력** | 높이 44px, 아이콘 + placeholder, 포커스 시 키보드 |
| **검색 결과** | 업종명 + 업종코드 표시, 각 항목 높이 52px |
| **최근 선택** | 가로 스크롤 칩, 이전에 선택했던 업종 최대 5개 |
| **현위치 버튼** | 지도 우측 하단 플로팅, 40×40px |

#### 인터랙션

**위치 확인:**
- Step 3에서 위치 선택 시 지도 자동 이동 + 바텀시트가 업종 검색으로 전환
- 주소 텍스트 탭 → Step 3 검색 바텀시트로 복귀 (위치 재선택)

**업종 검색:**
- 검색 필드 탭 → 바텀시트 확장 + 키보드 올라옴
- 한글 입력 시 200ms 디바운싱 후 로컬 캐시에서 퍼지 매칭
  - "치킨" → "치킨전문점 (CS100006)", "한식/치킨 (CS100012)" 등
  - "카페" → "커피-음료/카페 (CS100010)" 등
- 업종코드는 우측에 작게 표시 (개발자 참고용, 일반 사용자는 무시 가능)

**업종 선택:**
- 검색 결과 항목 탭 → Haptic(light)
- 선택 즉시 → 바텀시트 축소 + 지도에 기본 반경 원(500m) 미리보기
- 해당 업종코드로 경쟁업체 마커 표시
- 0.5초 대기 → 바텀시트가 자동으로 Step 5(반경 설정)로 전환

**최근 선택:**
- 이전에 선택했던 업종 칩 → 탭하면 검색 없이 바로 선택

#### 애니메이션

```javascript
onLocationConfirmed: {
  지도 카메라 이동 300ms cubic-bezier
  마커 핀드롭 400ms (위에서 떨어지는 효과)
  마커 펄스 1.5초 2회 반복
  바텀시트 업종검색 슬라이드업 200ms
}

onIndustrySelected(industryCode): {
  검색결과 항목 하이라이트 100ms
  haptic(light)
  바텀시트 축소 200ms
  지도에 반경원 fadeIn 300ms (미리보기)
  경쟁업체 마커 fadeIn 500ms (industryCode 기반 조회)
  0.5초 대기
  바텀시트 → Step 5 전환 slideUp 300ms
}
```

#### 업종코드 로컬 캐시 구현

```typescript
// 앱 초기 로드 시 업종코드 목록 fetch → 로컬 캐시
interface IndustryCode {
  code: string;           // "CS100006"
  name: string;           // "치킨전문점"
  category: string;       // "음식"
  keywords: string[];     // ["치킨", "닭", "후라이드", "양념"]
  source: 'golmok' | 'nps' | 'both';
}

// 퍼지 검색 (초성 검색 지원)
function searchIndustry(query: string, codes: IndustryCode[]): IndustryCode[] {
  const normalized = normalize(query); // 초성 분리 등
  return codes.filter(c =>
    c.name.includes(query) ||
    c.keywords.some(k => k.includes(query)) ||
    matchChosung(c.name, normalized)  // ㅊㅋ → 치킨
  );
}
```

---

### 🔵 Step 5: 반경 설정 + 실시간 경쟁업체 표시

#### 목표
지도 위 반경 원을 직접 손가락으로 조절하여 경쟁 범위를 설정하고, 실시간으로 경쟁업체 변화를 확인

#### 화면 구성

```
┌─────────────────────────────────────┐
│                                     │
│      [전체 화면 Kakao Map]         │
│                                     │
│         ╭─ ─ ─ ─ ─ ─╮             │
│        ╱  🟢  🟢      ╲            │
│       │   📍중심  🟢   │           │
│        ╲   🟢  🔴     ╱            │
│         ╰─ ─ ⬤─ ─ ─╯  ← 드래그   │
│              ↑ 핸들                 │
│                        [◎ 현위치]  │
│                                     │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│  ─── 드래그 핸들 ───              │
│                                     │
│  📍 강남역 · ☕ 카페 · 반경 500m  │
│                                     │
│  🟢 활성 12개  🟡 휴업 2개  🔴 폐업 1개 │
│                                     │
│  [분석 시작하기]                   │
│                                     │
└─────────────────────────────────────┘
```

#### 반경 직접 조절 (핵심 인터랙션)

반경 원의 **테두리 위 드래그 핸들(⬤)** 을 손가락으로 잡고 안/밖으로 드래그하여 반경을 직접 조절합니다.

```
드래그 핸들 동작:

  축소 (안으로 드래그)          확대 (밖으로 드래그)
       ╭─ ─ ─╮                   ╭─ ─ ─ ─ ─ ─ ─╮
      │  📍  ⬤←              →⬤               │
       ╰─ ─ ─╯                │      📍         │
     반경: 200m                 ╰─ ─ ─ ─ ─ ─ ─╯
                                  반경: 1.5km
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **반경 원** | 반투명 주색상 (fill opacity 0.12), 테두리 2px (opacity 0.6) |
| **드래그 핸들** | 원 테두리 하단에 위치, 20×20px 원형, 흰색 + 주색상 테두리 |
| **핸들 터치 영역** | 실제 시각 크기보다 넓게 60×60px (터치 편의성) |
| **반경 범위** | 100m ~ 3,000m |
| **반경 스냅** | 50m 단위로 스냅 (100, 150, 200, ... 3000) |
| **반경 라벨** | 원 테두리 옆에 실시간 거리 텍스트 표시 (예: "500m") |
| **경쟁업체 마커** | 활성(🟢 초록), 휴업(🟡 노랑), 폐업(🔴 빨강) 3가지 상태 색상 구분 |
| **바텀시트** | 높이 ~140px, 요약 정보 + 분석 시작 버튼 |

#### 인터랙션

**반경 드래그 조절:**

```
1. 드래그 핸들 터치 시작 (touchstart)
   → 핸들 스케일 1.3x 확대 + Haptic(light)
   → 반경 라벨 표시 ("500m")
2. 드래그 이동 (touchmove)
   → 중심점과 손가락 사이 거리 계산 → 반경 값 변환
   → 50m 단위 스냅마다 Haptic(selection)
   → 반경 원 실시간 리사이즈 (매 프레임)
   → 반경 라벨 실시간 업데이트
3. 드래그 종료 (touchend)
   → 핸들 스케일 1.0x 복귀
   → 최종 반경 값 고정
   → 500ms 디바운싱 후 경쟁업체 API 호출
   → 마커 업데이트 (신규 fadeIn, 범위 밖 fadeOut)
```

**경쟁업체 마커:**
- 마커 탭 → 말풍선 팝업 (상호명, 거리, 상태)
- 마커 색상: 활성(🟢 초록), 휴업(🟡 노랑), 폐업(🔴 빨강)
- 범위 밖 마커는 fadeOut, 범위 안 신규 마커는 fadeIn

**바텀시트:**
- 스와이프 업 → 경쟁업체 리스트 확장 (상세 목록 보기)
- "분석 시작하기" 탭 → Step 6(미리보기 → 분석)으로 전환

**실시간 업데이트 메커니즘:**

```
1. 사용자가 드래그 핸들에서 손을 뗌
2. onRadiusChangeEnd 이벤트 발생
3. 500ms 디바운싱 후 API 호출
4. NPS/NTS MCP → 반경 내 동일 업종 사업장 조회
5. GeoJSON 포맷으로 응답
6. 지도에 마커 diff 업데이트 (기존 유지, 신규 추가, 범위밖 제거)
7. 바텀시트 카운트 갱신 (활성/휴업/폐업)
8. 애니메이션: 신규 마커 fadeIn 300ms
```

#### 성능 최적화

| 기법 | 구현 |
|------|------|
| **반경 원 렌더링** | requestAnimationFrame으로 60fps 유지 (드래그 중) |
| **디바운싱** | 드래그 종료 후 500ms 대기 → API 호출 (드래그 중에는 미호출) |
| **마커 재사용** | 기존 마커 객체 업데이트 (재생성 X) |
| **클러스터링** | 마커 50개 이상 시 자동 클러스터링 |
| **캐싱** | 최근 5개 반경 결과 메모리 캐시 (같은 반경 재설정 시 즉시 표시) |

#### 반경 원 직접 조작 기술 구현

```typescript
// Kakao Map 위 Canvas/SVG 오버레이로 반경 원 + 핸들 구현
const RadiusCircle = ({ center, radius, onRadiusChange }) => {
  const handleRef = useRef(null);

  const onTouchMove = useCallback((e) => {
    const touch = e.touches[0];
    const touchLatLng = map.getProjection()
      .coordsFromContainerPoint(new kakao.maps.Point(touch.clientX, touch.clientY));

    // 중심점과 터치 위치 사이 거리 계산
    const distance = getDistance(center, touchLatLng);

    // 50m 단위 스냅
    const snapped = Math.round(distance / 50) * 50;
    const clamped = Math.max(100, Math.min(3000, snapped));

    onRadiusChange(clamped);
  }, [center, map]);

  return (
    <>
      <Circle center={center} radius={radius}
        fillColor="#2563EB" fillOpacity={0.12}
        strokeColor="#2563EB" strokeOpacity={0.6} strokeWeight={2} />
      <DragHandle position={getHandlePosition(center, radius)}
        onDrag={onTouchMove} />
    </>
  );
};
```

---

### 🎯 Step 6~7: AI 실시간 분석 + 프리미엄 전환 (핵심 UX)

#### 목표
Step 5에서 "분석 시작하기"를 탭하면, AI가 실시간으로 분석 리포트를 작성하듯 정보를 채워나감.
무료 범위까지 보여준 후 콘텐츠를 블러 처리하여 프리미엄 상세 분석을 자연스럽게 유도.

> **핵심 전략**: 사용자가 이미 가치를 체감한 상태에서 결제를 유도하는 "Taste → Gate" 패턴

#### 전체 플로우

```
"분석 시작하기" 탭
    ↓
[Phase A] AI 타이핑 — 무료 기본 분석 (5~8초)
    정보가 한 줄씩 실시간으로 채워짐
    사용자는 AI가 직접 분석하는 느낌을 받음
    ↓
[Phase B] 블러 게이트 — 프리미엄 전환 유도
    지금까지 작성된 내용은 그대로 유지
    아래쪽이 점점 흐려지면서
    "더 자세한 AI 상권 분석을 시작해볼까요?" 노출
    ↓
[분기 1] 무료 — 기본 결과만 확인
[분기 2] 프리미엄 — 블러 해제 + 상세 AI 리포트 계속 생성
```

---

#### Phase A: AI 실시간 타이핑 (무료 기본 분석)

"분석 시작하기" 탭 후 전체 화면이 분석 리포트 화면으로 전환됩니다.
API 응답이 들어올 때마다 AI가 타이핑하듯 한 줄씩 채워나갑니다.

```
┌─────────────────────────────────────┐
│                                     │
│  🤖 분석 중...                     │
│                                     │
│  📍 강남역 · ☕ 카페 · 500m       │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  📊 종합 점수                      │  ← 카운트업 0→75
│                                     │
│        75 / 100                    │
│     ████████████░░░░░ 조건부 추천   │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  ✍️ 이 지역은 카페 창업에          │  ← AI 타이핑 효과
│  적합한 조건을 갖추고 있습니다.    │
│  유동인구가 풍부하고 주변 소득     │
│  수준이 높아 충분한 수요가 기대    │
│  됩니다.|                          │  ← 커서 깜빡임
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  항목별 점수:                      │
│                                     │
│  🟢 상권 활력도   85/100          │  ← 순차 등장
│    "주변 사업장 직원 수 증가 추세" │
│                                     │
│  🟢 경쟁 강도     65/100          │  ← 2초 후 등장
│    "반경 내 동일 업종 15개,        │
│     적정 수준"                     │
│                                     │
│  🟢 생존율        78/100          │  ← 4초 후 등장
│    "2년 생존율 78%, 업계 평균      │
│     대비 양호"|                    │  ← 커서
│                                     │
│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░│  ← 여기서부터
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│     점점 블러
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
│                                     │
└─────────────────────────────────────┘
```

#### Phase A 세부 사항

| 요소 | 사양 |
|------|------|
| **종합 점수** | 카운트업 애니메이션 (0→75, 1.5초), 프로그레스 바 동시 채워짐 |
| **AI 요약 텍스트** | 타이핑 효과 (30ms/글자), 커서 깜빡임 ("|", 0.5초 주기) |
| **항목별 점수** | 각 항목 1.5~2초 간격으로 순차 등장, fadeIn + slideUp |
| **항목 코멘트** | 각 점수 아래 한 줄 AI 코멘트, 타이핑 효과 |
| **스크롤** | 내용이 채워질수록 자동 스크롤 다운 (사용자가 터치하면 자동 스크롤 중지) |
| **배경** | 흰색, 지도 없음 (분석 결과에 집중) |

#### Phase A 타이핑 시퀀스

```javascript
// AI 타이핑 시퀀스 (의사 코드)
async function runAnalysisAnimation(data) {

  // 1. 종합 점수 카운트업 (1.5초)
  await countUp(scoreDisplay, 0, data.totalScore, 1500);
  await typeText(gradeLabel, data.grade, 30); // "조건부 추천"

  // 2. AI 요약 타이핑 (3초)
  await typeText(summaryArea, data.aiSummary, 30); // 글자당 30ms

  // 3. 항목별 점수 순차 등장
  for (const metric of data.metrics) {
    await delay(1500);
    await fadeInSlideUp(metric.card, 300);
    await countUp(metric.scoreDisplay, 0, metric.score, 800);
    await typeText(metric.comment, metric.aiComment, 25);
  }

  // 4. 3개 항목 후 → Phase B (블러 게이트)
  await delay(500);
  triggerBlurGate();
}
```

---

#### Phase B: 블러 게이트 (프리미엄 전환 유도)

3개 항목(상권 활력도, 경쟁 강도, 생존율)까지 무료로 보여준 후,
나머지 콘텐츠가 점진적으로 블러 처리되며 프리미엄 유도 메시지가 등장합니다.

```
┌─────────────────────────────────────┐
│                                     │
│  (위에서 이어짐 — 기존 내용 유지)  │
│                                     │
│  🟢 생존율        78/100          │
│    "2년 생존율 78%, 업계 평균      │
│     대비 양호"                     │
│                                     │
│┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄│ ← 여기서 블러 시작
│                                     │
│  ░░ 주거 밀도     ░░/100  ░░░░░░  │ ← 블러 처리됨
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │
│                                     │
│  ░░ 소득 수준     ░░/100  ░░░░░░  │ ← 블러 처리됨
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │
│                                     │
│  ░░ 예상 매출 시뮬레이션 ░░░░░░░  │
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │
│                                     │
│  ┌───────────────────────────────┐ │
│  │                               │ │
│  │  💡 더 자세한 AI 상권 분석을  │ │
│  │     시작해볼까요?             │ │
│  │                               │ │
│  │  잠긴 항목:                   │ │
│  │  · 주거 밀도 & 소득 수준 분석 │ │
│  │  · 예상 매출 시뮬레이션       │ │
│  │  · AI 맞춤 창업 전략 리포트   │ │
│  │  · 경쟁업체 상세 비교 분석    │ │
│  │  · PDF 리포트 다운로드        │ │
│  │                               │ │
│  │  ┌───────────────────────┐   │ │
│  │  │ 상세 분석 시작 (₩3,900) │   │ │
│  │  └───────────────────────┘   │ │
│  │                               │ │
│  │  기본 결과만 확인할게요 →     │ │
│  │                               │ │
│  └───────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

#### Phase B 세부 사항

| 요소 | 사양 |
|------|------|
| **블러 전환** | 마지막 무료 항목 아래부터 점진적 블러 (blur 0px → 12px, 높이 100px 구간) |
| **블러 영역** | backdrop-filter: blur(12px), 텍스트/숫자 식별 불가하지만 형태는 보임 |
| **유도 카드** | 블러 영역 위에 플로팅, 흰색 배경, 그림자, border-radius 16px |
| **유도 메시지** | 20px 볼드, 따뜻한 톤, 물음표로 끝 (강요 아닌 제안) |
| **잠긴 항목 목록** | 14px, 각 항목 앞 "·", 사용자가 놓칠 수 있는 가치 나열 |
| **결제 버튼** | 높이 52px, 주색상, 가격 표시, 폭 100% |
| **무료 확인 링크** | 14px, 보조 텍스트, 밑줄 없음, 탭 시 블러 유지한 채 기본 결과 화면으로 |

#### 무료 vs 프리미엄 콘텐츠 경계

| 구분 | 무료 (기본 분석) | 프리미엄 (상세 분석) |
|------|-----------------|-------------------|
| **종합 점수** | ✅ 점수 + 등급 | ✅ |
| **AI 요약** | ✅ 2~3문장 | ✅ 상세 분석 리포트 |
| **상권 활력도** | ✅ 점수 + 한 줄 코멘트 | ✅ + 월별 트렌드 |
| **경쟁 강도** | ✅ 점수 + 한 줄 코멘트 | ✅ + 경쟁사 상세 비교 |
| **생존율** | ✅ 점수 + 한 줄 코멘트 | ✅ + 연도별 추이 |
| **주거 밀도** | 🔒 블러 | ✅ 상세 분석 |
| **소득 수준** | 🔒 블러 | ✅ 상세 분석 |
| **매출 시뮬레이션** | 🔒 블러 | ✅ 시나리오 조정 가능 |
| **AI 맞춤 전략** | 🔒 블러 | ✅ 창업 전략 리포트 |
| **PDF 다운로드** | ❌ | ✅ |

#### 분기 처리

**분기 1: "기본 결과만 확인할게요"**
```
블러 유지된 상태로 스크롤 가능
무료 3개 항목은 그대로 확인
블러 영역 탭 시 유도 카드 다시 표시
하단에 고정: "상세 분석 잠금 해제 →" 작은 배너
```

**분기 2: "상세 분석 시작" (결제)**
```
결제 완료
    ↓
블러 해제 애니메이션 (blur 12px → 0px, 800ms)
    ↓
AI 타이핑 이어서 계속 (중단된 곳부터)
    ↓
주거 밀도 점수 등장 + 코멘트 타이핑
소득 수준 점수 등장 + 코멘트 타이핑
    ↓
매출 시뮬레이션 카드 등장
    ↓
AI 종합 전략 리포트 타이핑
    ↓
"분석이 완료되었어요! 📊" 완료 메시지
    ↓
[결과 저장] [PDF 다운로드] [새 분석]
```

#### 블러 해제 애니메이션

```javascript
async function unlockPremium() {
  // 결제 확인
  await verifyPayment();

  // 블러 해제 (위→아래로 걷히는 효과)
  await animateBlur({
    from: 12, to: 0,
    duration: 800,
    easing: 'ease-out',
    direction: 'top-to-bottom'  // 위에서부터 걷힘
  });

  haptic('success');

  // AI 타이핑 이어서 계속
  await delay(300);
  for (const metric of remainingMetrics) {
    await fadeInSlideUp(metric.card, 300);
    await countUp(metric.scoreDisplay, 0, metric.score, 800);
    await typeText(metric.comment, metric.aiComment, 25);
    await delay(1000);
  }

  // 매출 시뮬레이션
  await fadeIn(revenueSimCard, 400);

  // AI 종합 전략 리포트
  await typeText(strategyReport, data.aiStrategy, 20);

  // 완료
  await fadeIn(completionMessage, 300);
  await fadeIn(actionButtons, 300);
}
```

#### 가격 정책 (Phase 2)

| 플랜 | 가격 | 건당 단가 | 포함 내용 |
|------|------|---------|---------|
| **건별 결제** | ₩3,900/건 | ₩3,900 | 상세 AI 분석 1회 |
| **월 구독 (Light)** | ₩9,900/월 | ₩990 (10건) | 상세 분석 10건/월, 추가 건당 ₩1,900 |
| **월 구독 (Pro)** | ₩19,900/월 | 무제한 | 무제한 분석 + PDF 다운로드 + 트렌드 알림 |

> **가격 책정 근거**
>
> **원가**: Haiku 모델 기준 건당 API 비용 ~₩100~300 + 공공 API 호출 + 서버비 = 건당 원가 ₩500 이하.
> 건별 ₩3,900에서 마진율 약 85%.
>
> **시장 포지셔닝**: golmok.seoul.go.kr(무료, AI 없음)과 전문 상권분석 컨설팅(₩50만+) 사이의 빈 시장.
> ₩3,900은 편의점 커피 한 잔 가격으로, 수천만 원을 투자하려는 창업자에겐 고민 없이 결제할 수 있는 금액.
> "이 가격에 이런 분석을?"이라는 반응을 유도하여 입소문과 바이럴 성장 기대.
>
> **구독 전환 유도**: 건별 ₩3,900 결제 후 "월 구독하면 건당 ₩990"이라는 가격 차이가
> 여러 위치를 비교 분석하는 헤비유저의 구독 전환을 유도.
>
> **Phase 3+ 확장**: Opus 모델 기반 프리미엄 리포트 (₩9,900/건), B2B 엔터프라이즈 플랜 등 추가 예정.

#### 결제 UX 고려사항

| 항목 | 설계 |
|------|------|
| **가격 표시** | 버튼에 직접 "₩3,900" 표시 (숨기지 않음, 투명하게) |
| **구독 유도** | 건별 결제 버튼 아래에 "월 구독 시 건당 ₩990부터" 텍스트 |
| **결제 방식** | 인앱 결제 (Apple Pay / Google Pay / 카드) |
| **결제 실패** | 토스트 + 재시도 버튼, 기본 결과는 유지 |
| **환불 정책** | 결제 카드 하단에 작게 "24시간 내 환불 가능" 표시 |
| **첫 결제 프로모션** | "첫 분석 무료" 또는 "₩1,000 체험가" 로 전환율 부스트 (선택) |

---

### 🔔 공공 API 데이터 소스 신뢰도 시스템 (Data Source Trust System)

#### 배경

본 서비스는 공공기관의 신뢰도 있는 데이터를 기반으로 분석하는 것이 핵심 가치입니다.
그러나 공공 API는 서버 점검, 트래픽 과부하, 일시적 장애 등으로 실패가 빈번합니다.

현재 구현: 3회 재시도 → 실패 시 mock 데이터 fallback.
**문제**: 사용자가 지금 보고 있는 데이터가 실제 공공데이터인지, mock인지 알 수 없음.
**해결**: 데이터 출처와 상태를 투명하게 보여줘서 신뢰를 유지.

#### 데이터 소스 상태 3단계

| 상태 | 아이콘 | 의미 | 색상 |
|------|--------|------|------|
| **정상** | 🟢 | API 직접 호출 성공, 실시간 데이터 | #10B981 (green) |
| **캐시** | 🟡 | API 실패 → 최근 캐시 데이터 사용 중 | #F59E0B (yellow) |
| **미반영** | 🔴 | API 실패 + 캐시 없음 → mock fallback, 점수에 미반영 | #EF4444 (red) |

#### 화면 설계: 결과 화면 내 데이터 소스 패널

```
┌─────────────────────────────────────┐
│                                     │
│  🎉 분석이 완료되었어요!           │
│                                     │
│  ┌─────────────────────────────┐  │
│  │   종합 점수: 75/100         │  │
│  │                              │  │
│  │  ⚠️ 일부 데이터 미반영       │  │ ← API 실패 시에만 표시
│  │     (탭하여 상세 보기)       │  │
│  └─────────────────────────────┘  │
│                                     │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  │
│                                     │
│  주요 지표:                        │
│  🟢 상권 활력도: 85/100  NPS      │ ← 정상
│  🟢 경쟁 강도: 65/100   NTS      │ ← 정상
│  🟡 생존율: 78/100      NTS      │ ← 캐시 데이터
│  🔴 주거 밀도: --/100   KOSIS    │ ← 미반영
│  🟢 소득 수준: 68/100   실거래가  │ ← 정상
│                                     │
└─────────────────────────────────────┘

⚠️ 경고 배너 탭 시 상세 패널 확장:

┌─────────────────────────────────────┐
│  📡 데이터 소스 현황               │
│                                     │
│  🟢 NPS 국민연금공단        정상   │
│     사업장 가입내역 · 2초 전 갱신  │
│                                     │
│  🟢 NTS 국세청              정상   │
│     사업자 상태확인 · 3초 전 갱신  │
│                                     │
│  🟡 NTS 국세청 (폐업이력)   캐시   │
│     2시간 전 데이터 사용 중        │
│     "NTS API 응답 지연"            │
│                                     │
│  🔴 KOSIS 통계청            실패   │
│     "KOSIS Open API 서버와의       │
│      통신이 원활하지 않습니다"      │
│     점수 산정에서 제외됨           │
│     [재시도]                       │
│                                     │
│  🟢 서울 골목상권 API       정상   │
│     추정매출/유동인구 · 1초 전     │
│                                     │
│  🟢 실거래가 API            정상   │
│     아파트 시세 · 2초 전 갱신      │
│                                     │
│  ─────────────────────────────────  │
│  데이터 반영률: 5/6 (83%)          │
│  ⚠️ 미반영 항목의 가중치는 나머지   │
│     지표에 재분배되어 계산됩니다    │
│                                     │
│  [전체 재시도] [이대로 확인]       │
│                                     │
└─────────────────────────────────────┘
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **경고 배너** | 종합 점수 카드 내부, 노란/빨간 배경, 14px, 탭 가능 |
| **배너 표시 조건** | 1개 이상 API가 캐시 또는 실패 상태일 때만 표시 |
| **전체 정상 시** | 배너 미표시, 지표 옆 🟢만 작게 표시 |
| **상세 패널** | 바텀시트 확장, 각 API별 상태 + 메시지 + 갱신 시간 |
| **재시도 버튼** | 개별 API 재시도 또는 전체 재시도 |
| **미반영 지표** | 점수 "--" 표시, 해당 가중치 다른 지표에 재분배 |
| **데이터 반영률** | 하단에 "5/6 (83%)" 형태로 전체 신뢰도 표시 |

#### 지표별 인라인 표시

각 점수 항목 옆에 데이터 출처와 상태를 표시합니다:

```
정상 시:     🟢 상권 활력도: 85/100
캐시 시:     🟡 생존율: 78/100  ⓘ 2시간 전 데이터
미반영 시:   🔴 주거 밀도: --/100  ⚠️ KOSIS 통신 실패
```

- 🟡 탭 시 → 툴팁: "NTS API 응답 지연으로 2시간 전 캐시 데이터를 사용 중입니다"
- 🔴 탭 시 → 툴팁: "KOSIS Open API 서버와의 통신이 원활하지 않습니다. 해당 지표는 점수 산정에서 제외되었습니다" + [재시도] 버튼

#### 점수 재계산 로직

API 실패로 특정 지표가 미반영될 경우, 나머지 지표의 가중치를 비례 재분배합니다.

```typescript
// 예: KOSIS 실패 → 주거 밀도(15%) 미반영
// 기존 가중치: 활력도 30%, 경쟁 25%, 생존율 20%, 주거 15%, 소득 10%
// 재분배:      활력도 35.3%, 경쟁 29.4%, 생존율 23.5%, 소득 11.8%

interface DataSourceStatus {
  source: 'NPS' | 'NTS' | 'KOSIS' | 'GOLMOK' | 'REALESTATE';
  status: 'live' | 'cached' | 'failed';
  lastUpdated?: ISO8601;
  errorMessage?: string;    // "KOSIS Open API 서버와의 통신이 원활하지 않습니다"
  retryCount: number;       // 현재까지 재시도 횟수
  cachedAt?: ISO8601;       // 캐시 데이터 시점
}

function recalculateWeights(
  statuses: DataSourceStatus[],
  originalWeights: Record<string, number>
): Record<string, number> {
  const failed = statuses
    .filter(s => s.status === 'failed')
    .map(s => s.source);

  // 실패한 지표의 가중치 합계
  const failedWeight = failed.reduce(
    (sum, src) => sum + originalWeights[src], 0
  );

  // 나머지 지표에 비례 재분배
  const activeWeight = 1 - failedWeight;
  const adjusted: Record<string, number> = {};

  for (const [key, weight] of Object.entries(originalWeights)) {
    if (failed.includes(key)) {
      adjusted[key] = 0; // 미반영
    } else {
      adjusted[key] = weight / activeWeight; // 비례 확대
    }
  }
  return adjusted;
}
```

#### 알림 메시지 템플릿

| 상황 | 메시지 |
|------|--------|
| NPS 실패 | "국민연금공단(NPS) 사업장 데이터 서버와의 통신이 원활하지 않습니다" |
| NTS 실패 | "국세청(NTS) 사업자등록 상태 확인 서버와의 통신이 원활하지 않습니다" |
| KOSIS 실패 | "통계청(KOSIS) Open API 서버와의 통신이 원활하지 않습니다" |
| 골목상권 실패 | "서울시 골목상권 분석 API 서버와의 통신이 원활하지 않습니다" |
| 실거래가 실패 | "국토교통부 실거래가 API 서버와의 통신이 원활하지 않습니다" |
| 전체 정상 | 표시 없음 (깔끔한 UI 유지) |
| 2개 이상 실패 | "⚠️ 복수의 공공데이터 소스에 접근할 수 없습니다. 분석 정확도가 낮을 수 있습니다" |

#### Retry 정책

```typescript
const RETRY_CONFIG = {
  maxRetries: 3,
  retryDelay: [1000, 2000, 4000],  // 지수 백오프 (1초, 2초, 4초)
  timeout: 5000,                    // 개별 요청 타임아웃
  fallbackOrder: ['live', 'cached', 'mock'],
};

async function fetchWithFallback(source: DataSource): Promise<DataResult> {
  // 1차: 실시간 API 호출 (3회 재시도)
  for (let i = 0; i < RETRY_CONFIG.maxRetries; i++) {
    try {
      const data = await fetchAPI(source, RETRY_CONFIG.timeout);
      await updateCache(source, data);
      return { data, status: 'live', source };
    } catch (e) {
      await delay(RETRY_CONFIG.retryDelay[i]);
    }
  }

  // 2차: 캐시 데이터 확인
  const cached = await getCache(source);
  if (cached && !isExpired(cached, 24 * 60)) { // 24시간 이내 캐시
    return { data: cached.data, status: 'cached', source,
             cachedAt: cached.timestamp };
  }

  // 3차: mock 데이터 fallback
  return { data: getMockData(source), status: 'failed', source,
           errorMessage: ERROR_MESSAGES[source] };
}
```

---

### 📊 Step 7: 분석 결과 요약 카드

#### 목표
분석 완료 후 핵심 결과를 한눈에 표시하고, 데이터 소스 상태를 투명하게 보여주며, 상세 리포트로의 진입점 제공

#### 화면 구성

```
┌─────────────────────────────────────┐
│                                     │
│  🎉 분석이 완료되었어요!           │
│                                     │
│  ┌─────────────────────────────┐  │
│  │   종합 점수                 │  │
│  │                             │  │
│  │        75/100              │  │
│  │      ⭐⭐⭐⭐              │  │
│  │                             │  │
│  │   입지 적합도: 높음 ✓       │  │
│  │   추천 여부: 네 👍          │  │
│  │                             │  │
│  │ ⚠️ 일부 데이터 미반영 (탭)  │  │ ← 실패 시에만
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │  주요 지표                  │  │
│  │  ─────────────────────────  │  │
│  │  🟢 상권 활력도: 85/100    │  │
│  │  🟢 경쟁 강도: 65/100      │  │
│  │  🟡 생존율: 78/100    ⓘ   │  │ ← 캐시
│  │  🔴 주거 밀도: --/100  ⚠️  │  │ ← 실패
│  │  🟢 소득 수준: 68/100      │  │
│  │                             │  │
│  │  📡 데이터 반영률 83% (5/6) │  │
│  └─────────────────────────────┘  │
│                                     │
│  ┌─────────────────────────────┐  │
│  │  📊 상세 분석 리포트 보기   │  │
│  └─────────────────────────────┘  │
│                                     │
│  [분석 재시도] [결과 저장]         │
│                                     │
└─────────────────────────────────────┘
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **종합 점수 영역** | 중앙, 큰 텍스트 (48px), 색상 동적 (높음: 초록, 중간: 노랑, 낮음: 빨강) |
| **별 표시** | 5색 별, 각 별 24px |
| **추천 메시지** | 14px, 따뜻한 톤, 말풍선 스타일 |
| **데이터 경고 배너** | 14px, 노란/빨간 배경, 1개 이상 실패 시에만 표시 |
| **지표 상태 아이콘** | 각 지표 앞 🟢🟡🔴, 탭 시 상세 툴팁 |
| **데이터 반영률** | 지표 카드 하단, 14px, "📡 데이터 반영률 83% (5/6)" |
| **상세 보기 버튼** | 높이 48px, 주색상, 폭 100% |
| **분석 재시도** | 실패 API만 재호출 후 점수 재계산 |

#### 애니메이션

```
Step 7 진입:
1. 배경 페이드인 (200ms)
2. 축하 아이콘 바운스 애니메이션 (300ms)
3. 종합 점수 카운트업 애니메이션 (0 → 75, 1000ms)
   - 숫자가 증가하는 듯한 느낌
4. 별 그리기 애니메이션 (200ms per star)
5. 지표 바 애니메이션 (각 600ms, staggered)
6. 메시지 텍스트 페이드인 (400ms)
7. 버튼 페이드인 (500ms)
```

**의사 코드:**
```typescript
onStepSevenEnter: {
  await fadeIn(background, 200);
  await bounce(celebrateIcon, 300); // scale 1 → 1.3 → 1

  // Count up animation
  for (let i = 0; i <= 75; i += 5) {
    scoreText = i;
    await delay(13); // 13ms per increment = 1000ms total
  }

  // Stars
  for (let i = 0; i < 5; i++) {
    await drawStar(stars[i], 200, i * 50); // stagger 50ms
  }

  // Indicator bars
  for (let i = 0; i < 5; i++) {
    await animateBar(bars[i], 600, i * 100); // stagger 100ms
  }

  await fadeIn(message, 400, 1500); // delay 1500ms
  await fadeIn(buttons, 500, 2000);
}
```

---

### 📄 Step 8: AI 리포트 진입

#### 목표
상세 AI 분석 리포트 화면으로 부드러운 전환 및 풍부한 인사이트 제공

#### 화면 구성

```
┌─────────────────────────────────────┐
│  ← 뒤로        🔖 저장   ⚙️        │
├─────────────────────────────────────┤
│                                     │
│  📍 강남역, 카페                   │
│  반경 500m                         │
│                                     │
│  종합 점수: 75/100 ⭐⭐⭐⭐        │
│                                     │
├─────────────────────────────────────┤
│  📋 분석 리포트                     │
│                                     │
│  1️⃣ 상권 활력도 (85/100)           │
│                                     │
│  이 지역은 주중/주말 상관없이      │
│  사람의 흐름이 활발합니다.         │
│  카페는 충분한 고객 수요가         │
│  예상됩니다.                       │
│                                     │
│  [더보기 ▼]                       │
│                                     │
│ ─────────────────────────────────  │
│                                     │
│  2️⃣ 경쟁 강도 (65/100)            │
│                                     │
│  현재 반경 내에 경쟁사 15개가      │
│  있습니다. 이 중 6개가 프리미엄   │
│  카페입니다.                       │
│                                     │
│  [경쟁사 분석 보기]                │
│                                     │
│ ─────────────────────────────────  │
│  [더 많은 지표 보기]               │
│                                     │
└─────────────────────────────────────┘
```

#### 탭 구조 (Phase 1과 호환)

```
Step 8 화면 상단에 탭:
├─ 📊 점수 (Score) - 현재 보이는 화면
├─ 📍 지도 (Map) - 경쟁사 위치
├─ 📈 트렌드 (Trends) - Phase 2 추가 기능
├─ 📋 업체 목록 (Shops) - 경쟁사 목록
└─ 🤖 AI리포트 (AI Report) - 종합 분석
```

#### 세부 사항

| 요소 | 사양 |
|------|------|
| **헤더** | 위치 요약, 종합 점수, 뒤로/저장/설정 버튼 |
| **탭 바** | 고정, 각 탭 너비 equal 또는 자동 |
| **콘텐츠 카드** | 스크롤 가능, 각 카드 패딩 16px |
| **더보기 버튼** | 16px, 주색상, 언더라인 |
| **섹션 분리** | 회색 선, 높이 1px |

#### 인터랙션

**스크롤:**
- 세로 스크롤로 리포트 내용 확인
- 상단 고정: 위치 요약, 종합 점수 (iOS의 sticky header)

**탭 전환:**
- 탭 터치 → 탭 하이라이트 (200ms)
- 콘텐츠 페이드 전환 (200ms)
- 가로 스와이프로도 탭 전환 가능 (Option)

**더보기 버튼:**
- 클릭 → 내용 확장 (아코디언 스타일)
- 텍스트 "더보기" → "닫기"로 변경

#### AI 리포트 콘텐츠 예시

```
🤖 AI 분석 리포트
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 추천 입지: 그렇습니다!

강남역 주변은 카페 창업에 매우 적합한
입지입니다. 다음 이유들이 있습니다:

1. 높은 유동 인구
   - 역 일일 이용객: 약 300,000명
   - 주중 평균: 280,000명

2. 낮은 경쟁도
   - 경쟁사 15개 (적절한 수준)
   - 프리미엄 카페 비중: 40% (차별화 가능)

3. 높은 소비력
   - 평균 소득: 상위 20%
   - 커피 소비 선호도: 높음

4. 생존율 분석
   - 2년 생존율: 78% (업계 평균 68%)
   - 5년 생존율: 62% (업계 평균 52%)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 예상 매출 시뮬레이션 (Phase 2 추가)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

월 평균 예상 매출: 8,500,000원
- 일 평균 고객: 120명
- 평균 주문액: 6,500원
- 오픈 시간: 10:00 ~ 22:00 (12시간)

시뮬레이션 조건:
- 평방 36m² (약 11평)
- 테이블 6개, 좌석 18개
- 직원 3명 (오너 포함)
- 임대료: 2,000,000원/월 (예상)

⚠️ 주의: 이는 예상치이며 실제 결과는
다를 수 있습니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 추가 조언
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 임차료 협상: 이 지역의 평균 임대료는
   2,000만원입니다. 초기 계약금 최소화를
   권장합니다.

2. 차별화 전략: 프리미엄 카페 40%이므로
   고급 원두 강조, 디저트 라인업 강화 추천

3. 타이밍: 현재(2월)는 오픈 시즌입니다.
   3-5월 내 오픈을 권장합니다.
```

---

## 🖼️ 화면 설계 명세 (Screen Design Specifications)

### 전체 색상 팔레트

| 색상 | Hex | RGB | 사용처 |
|------|-----|-----|--------|
| **주색상 (Primary)** | #2563EB | (37, 99, 235) | 주요 버튼, 강조 |
| **성공색** | #10B981 | (16, 185, 129) | 긍정 정보, 체크 |
| **경고색** | #F59E0B | (245, 158, 11) | 경고, 경고 배지 |
| **위험색** | #EF4444 | (239, 68, 68) | 오류, 부정 정보 |
| **배경색** | #F3F4F6 | (243, 244, 246) | 페이지 배경 |
| **텍스트 주색** | #111827 | (17, 24, 39) | 본문 텍스트 |
| **텍스트 보조** | #6B7280 | (107, 114, 128) | 부문 텍스트 |
| **테두리색** | #E5E7EB | (229, 231, 235) | 구분선, 테두리 |

### 타이포그래피

| 용도 | 크기 | 굵기 | 줄높이 | 예시 |
|------|-----|------|--------|------|
| **H1 (페이지 제목)** | 28px | 700 Bold | 1.3 | "창업을 준비중이신가요?" |
| **H2 (섹션 제목)** | 20px | 600 Semibold | 1.3 | "분석 지표" |
| **H3 (카드 제목)** | 18px | 600 Semibold | 1.4 | "상권 활력도" |
| **본문 (Body)** | 16px | 400 Regular | 1.5 | 일반 설명 문구 |
| **라벨 (Label)** | 14px | 500 Medium | 1.4 | 버튼, 필터 텍스트 |
| **조그만 (Caption)** | 12px | 400 Regular | 1.4 | 보조 정보, 거리 |

### 컴포넌트 명세

#### 1. 버튼 (Button)

**Primary Button**
```
높이: 48px (최소 44px)
패딩: 12px 16px
모서리: border-radius 8px
텍스트: 16px Bold, 흰색
배경: #2563EB
상태:
  - Normal: 위 배경색
  - Hover: 밝기 +10% (#3B82F6)
  - Active: 스케일 98%, 그림자 감소
  - Disabled: 투명도 50%, 비활성
```

**Secondary Button**
```
높이: 48px
패딩: 12px 16px
모서리: border-radius 8px
텍스트: 16px Medium, #2563EB
배경: 투명
테두리: 1px #2563EB
상태:
  - Normal: 위 사양
  - Hover: 배경 #EFF6FF
  - Active: 스케일 98%
```

#### 2. 입력 필드 (Input Field)

```
높이: 44px
패딩: 12px 16px
모서리: border-radius 8px
텍스트: 16px Regular
테두리: 1px #E5E7EB
배경: 흰색

상태:
  - Focus: 테두리 2px #2563EB, 배경 #F0F9FF
  - Filled: 배경 유지
  - Error: 테두리 #EF4444

Placeholder: 14px, #9CA3AF
```

#### 3. 바텀 시트 (Bottom Sheet)

```
높이: 화면의 40% ~ 90%
백그라운드: 흰색, 상단 radius 16px
그림자: 0 -2px 10px rgba(0,0,0,0.1)
드래그 핸들: 상단 중앙, 4px × 40px, #D1D5DB

애니메이션:
  - 진입: 슬라이드 업 300ms, cubic-bezier(0.34, 1.56, 0.64, 1)
  - 종료: 슬라이드 다운 200ms, ease-out
```

#### 4. 카드 (Card)

```
패딩: 16px
모서리: border-radius 12px
배경: 흰색
테두리: 1px #E5E7EB
그림자: 0 1px 3px rgba(0,0,0,0.1)

호버 상태:
  - 그림자: 0 4px 12px rgba(0,0,0,0.15)
  - 변환: translateY -2px
```

#### 5. 슬라이더 (Slider)

```
높이: 44px (터치 영역 포함)
트랙 높이: 4px
트랙 배경: #E5E7EB
트랙 진행: #2563EB
썸 크기: 24px × 24px
썸 배경: #2563EB
썸 그림자: 0 2px 8px rgba(37, 99, 235, 0.3)

상태:
  - Dragging: 썸 스케일 1.2, 그림자 확대
  - Haptic: 매 단계 변경마다 경미한 진동
```

---

## 🎭 인터랙션 디자인 (Interaction Design)

### 제스처 가이드라인

#### 1. 탭 (Tap)
```
모든 버튼, 카드, 칩에 사용
피드백:
  - 시각: 스케일 98% (100ms), 색상 변화
  - 음향: 시스템 톤 (선택사항)
  - 촉각: Light impact haptic
```

#### 2. 스와이프 (Swipe)
```
반경 슬라이더: 수평 스와이프
  - 최소 거리: 10px
  - 속도: 100px/s 이상
  - 피드백: 실시간 값 업데이트, 500ms 디바운싱

탭 전환: 수평 스와이프 (좌/우)
  - 최소 거리: 50px
  - 속도: 200px/s 이상
  - 피드백: 페이드 전환 (200ms)
```

#### 3. 핀치 (Pinch)
```
지도 줌 인/아웃
  - 시스템 기본값 사용 (Kakao Map SDK)
  - 핀치 범위: 0.8x ~ 2x
  - 피드백: 실시간 줌 레벨 표시
```

#### 4. 롱 프레스 (Long Press)
```
경쟁업체 마커: 2초 유지
  - 피드백: 마커 하이라이트, 풍선 팝업
  - 액션: 업체 상세 정보 표시
```

#### 5. 드래그 (Drag)
```
바텀 시트: 상단 핸들로 드래그 (수직)
  - 최소 거리: 30px
  - 피드백: 실시간 위치 변화, 부드러운 부메랑

지도: 손가락으로 드래그하여 이동 (Kakao Map 기본)
```

### 마이크로 인터랙션

#### 1. 로딩 상태

**Skeleton Screen** (데이터 로딩 중)
```
카드 형태의 회색 플레이스홀더
애니메이션: 좌우 반복 shine 효과 (1.5초)
예: 텍스트 영역 → 회색 바, 이미지 영역 → 회색 정사각형
```

**스피너** (분석 진행 중)
```
중앙 원형 스피너
크기: 40px × 40px
회전: 1초마다 360도 회전, 직선 가속
색상: #2563EB
```

**프로그레시브 바** (진행 표시)
```
높이: 2px, 폭: 100%
배경: #E5E7EB
진행: #2563EB, 애니메이션 주기 2초
메시지: "데이터 수집 중... 35%"
```

#### 2. 알림 메시지

**토스트 (Toast)**
```
위치: 하단 중앙, 화면에서 16px 여유
높이: 48px
패딩: 12px 16px
배경: #111827 (다크), 투명도 90%
텍스트: 14px 흰색
애니메이션: 페이드인 200ms → 유지 3초 → 페이드아웃 200ms
```

**배너 (Banner)**
```
위치: 상단 또는 하단
높이: 56px (아이콘 포함)
패딩: 12px 16px
배경: 상태별 색상 (성공 #D1FAE5, 경고 #FEF3C7 등)
텍스트: 상태별 색상 (성공 #065F46, 경고 #92400E 등)
```

#### 3. 상태 전환 애니메이션

**페이드 전환** (Step 간 전환)
```
이전 화면: fadeOut 200ms
다음 화면: fadeIn 200ms (또는 동시 시작)
전체: 200ms
```

**슬라이드 업** (바텀 시트 진입)
```
변환: translateY(100%) → translateY(0)
시간: 300ms
이징: cubic-bezier(0.34, 1.56, 0.64, 1) (bounce)
```

**슬라이드 다운** (바텀 시트 퇴출)
```
변환: translateY(0) → translateY(100%)
시간: 200ms
이징: ease-out
```

**스케일 애니메이션** (강조, 버튼 클릭)
```
변환: scale(1) → scale(0.98) → scale(1)
시간: 100ms → 50ms (Bounce)
용도: 버튼 클릭 피드백
```

### Haptic Feedback 정책

| 시나리오 | 피드백 종류 | 강도 |
|---------|-----------|------|
| 버튼 탭 | Light Impact | Light |
| 반경 조정 (50m 단위) | Selection | Medium |
| 위치 확정 | Success | Heavy |
| 오류 (입력 실패) | Failure | Heavy |
| 분석 완료 | Success + Pattern | Heavy |

---

## 💻 기술 요구사항 (Technical Requirements)

### 개발 스택

| 계층 | 기술 스택 |
|------|---------|
| **Frontend Framework** | Next.js 14+ (App Router) |
| **언어** | TypeScript 5.x |
| **스타일링** | Tailwind CSS 3.x + CSS-in-JS (animations) |
| **상태 관리** | Zustand 또는 TanStack Query |
| **지도** | Kakao Map API SDK 2.x |
| **제스처** | React-use-gesture 또는 @use-gesture/react |
| **애니메이션** | Framer Motion 또는 React Spring |
| **HTTP Client** | Axios 또는 Fetch API |
| **번들러** | Next.js 내장 (Webpack/Turbopack) |

### Kakao Map SDK 모바일 최적화

#### 로딩 및 초기화

```typescript
// 동적 로드 (성능 최적화)
useEffect(() => {
  if (!window.kakao) {
    const script = document.createElement('script');
    script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KEY&libraries=services,clusterer,drawing';
    script.async = true;
    document.head.appendChild(script);
    script.onload = initializeMap;
  }
}, []);

// 모바일 최적화 설정
const mapOptions = {
  center: new kakao.maps.LatLng(latitude, longitude),
  level: 5, // 모바일에서 적절한 줌 레벨
  mapTypeControl: false, // 불필요한 컨트롤 제거
  zoomControl: false, // 커스텀 줌 버튼 사용
  disableDoubleClickZoom: true, // 더블 탭 줌 비활성화 (핀치로 대체)
};
```

#### 마커 클러스터링

```typescript
// 경쟁업체가 50개 이상일 경우 클러스터링
const clusterer = new kakao.maps.MarkerClusterer({
  map: map,
  averageCenter: true,
  minLevel: 10, // 줌 레벨 10부터 클러스터링
});

clusterer.addMarkers(markerArray);
```

#### 지도 스타일 (다크 모드 대응)

```typescript
// 향후 다크 모드 대응
const darkMapStyle = [
  {
    'featureType': 'all',
    'elementType': 'labels.text.fill',
    'stylers': [{ 'color': '#ffffff' }]
  },
  // ... 추가 스타일링
];

if (isDarkMode) {
  map.setStyle(darkMapStyle);
}
```

### 반응형 디자인 브레이크포인트

| 브레이크포인트 | 화면 너비 | 용도 |
|-------------|---------|------|
| **sm** | 640px | 작은 모바일 (iPhone 5-SE) |
| **md** | 768px | 태블릿 포트레이트 |
| **lg** | 1024px | 태블릿 랜드스케이프 |
| **xl** | 1280px | 데스크톱 |

**Tailwind 설정:**
```javascript
module.exports = {
  theme: {
    screens: {
      'sm': '350px',  // 최소 모바일
      'md': '768px',
      'lg': '1024px',
      'xl': '1280px',
    },
  },
}
```

**CSS 미디어 쿼리:**
```css
/* 모바일 우선 */
.container {
  padding: 12px; /* 기본 모바일 */
}

@media (min-width: 768px) {
  .container {
    padding: 20px; /* 태블릿 */
  }
}

@media (min-width: 1024px) {
  .container {
    padding: 24px; /* 데스크톱 */
  }
}
```

### PWA (Progressive Web App) 고려사항

#### manifest.json

```json
{
  "name": "소상공인 창업 분석기",
  "short_name": "창업 분석기",
  "description": "모바일-퍼스트 창업 입지 분석 앱",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#2563EB",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ]
}
```

#### Service Worker (캐싱 전략)

```javascript
// pages/api/service-worker.js
// Cache-first for static assets
// Network-first for API calls (with fallback)

const CACHE_NAME = 'startup-analyzer-v2';
const ASSETS_TO_CACHE = [
  '/',
  '/icons/favicon.ico',
  '/fonts/pretendard.woff2',
];

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll(ASSETS_TO_CACHE);
    })
  );
});

self.addEventListener('fetch', (event) => {
  if (event.request.url.includes('/api/')) {
    // API: network-first
    event.respondWith(
      fetch(event.request)
        .then((response) => {
          caches.open(CACHE_NAME).then((cache) => {
            cache.put(event.request, response.clone());
          });
          return response;
        })
        .catch(() => caches.match(event.request))
    );
  } else {
    // Static: cache-first
    event.respondWith(
      caches.match(event.request).then((response) => {
        return response || fetch(event.request);
      })
    );
  }
});
```

### 성능 최적화 요구사항

| 항목 | 목표 | 구현 방법 |
|------|------|---------|
| **초기 로딩** | 3초 이내 | Code splitting, lazy loading, 압축 |
| **지도 로딩** | 2초 이내 | 동적 스크립트 로드, 캐싱 |
| **반경 업데이트** | 500ms 이내 | 디바운싱, 마커 재사용, 가상화 |
| **페이지 전환** | 200ms 이내 | 애니메이션 최적화, 프리페칭 |
| **Lighthouse Score** | 85+ | 이미지 최적화, 번들 크기 감소 |

---

## 🔗 데이터 연동 (Data Integration)

### API 플로우 다이어그램

```
┌──────────────────────────────────────────────────────────┐
│                    Mobile App (Next.js)                 │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  Step 1-3: 위치 검색                                   │
│       ↓                                                  │
│  Kakao Geocoding API                                   │
│  (주소 ↔ 좌표 변환)                                    │
│       ↓                                                  │
│  지도에 마커 표시                                       │
│                                                          │
│  Step 4-5: 반경 설정 + 경쟁업체 조회                   │
│       ↓                                                  │
│  Backend API (/api/competitors)                        │
│       ↓                                                  │
│  ┌─ NPS API (사업장 정보: 직원수/급여/생존)             │
│  ├─ NTS API (사업자 3단계 상태: 영업/휴업/폐업) ← NEW  │
│  ├─ KOSIS API (인구 통계)                              │
│  ├─ Seoul Golmok API (골목상권)                        │
│  └─ 실거래가 API (임대료)                              │
│       ↓                                                  │
│  경쟁업체 목록 (GeoJSON)                               │
│  실시간 업데이트                                        │
│                                                          │
│  Step 6: 분석 요청                                      │
│       ↓                                                  │
│  Backend API (/api/analyze)                            │
│       ↓                                                  │
│  ┌─ 점수 계산 (5 지표, 결정적 스코어링)                │
│  ├─ AI 리포트 생성 (Claude Haiku)                      │
│  └─ 예상 매출 시뮬레이션                              │
│       ↓                                                  │
│  종합 점수 및 인사이트                                  │
│                                                          │
│  Step 7-8: 결과 표시                                   │
│       ↓                                                  │
│  탭별 상세 정보 제공                                    │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 반경 내 경쟁업체 조회 (Real-time Updates)

#### API 엔드포인트

```
POST /api/competitors
Content-Type: application/json

{
  "latitude": 37.4979,
  "longitude": 127.0276,
  "radiusMeters": 500,
  "industry": "카페", // 선택사항
  "limit": 50
}

Response:
{
  "success": true,
  "data": {
    "competitors": [
      {
        "id": "comp_001",
        "name": "스타벅스 강남역점",
        "latitude": 37.4980,
        "longitude": 127.0280,
        "distance": 45, // 미터 단위
        "industry": "카페",
        "type": "프리미엄",
        "established": "2020-03",
        "rating": 4.5,
        "reviewCount": 342
      },
      // ... 추가 업체
    ],
    "summary": {
      "totalCount": 15,
      "byType": {
        "카페": 6,
        "베이커리": 3,
        "음료점": 6
      }
    }
  }
}
```

#### 실시간 업데이트 구현

**Option 1: Polling (권장 초기 버전)**
```typescript
// 반경 변경 시 500ms 디바운싱 후 호출
const fetchCompetitors = useCallback(
  debounce(async (lat, lng, radius) => {
    setLoading(true);
    try {
      const response = await fetch('/api/competitors', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          latitude: lat,
          longitude: lng,
          radiusMeters: radius,
        }),
      });
      const data = await response.json();
      updateMapMarkers(data.competitors);
    } finally {
      setLoading(false);
    }
  }, 500),
  []
);
```

**Option 2: WebSocket (향후 고도화)**
```typescript
// 실시간 스트리밍 경쟁업체 업데이트
useEffect(() => {
  const ws = new WebSocket(`wss://api.example.com/competitors`);

  ws.onopen = () => {
    ws.send(JSON.stringify({
      action: 'subscribe',
      latitude: userLat,
      longitude: userLng,
      radiusMeters: 500,
    }));
  };

  ws.onmessage = (event) => {
    const update = JSON.parse(event.data);
    // 마커 추가/제거/업데이트 (diff 기반)
    updateMapMarkersIncremental(update);
  };

  return () => ws.close();
}, [userLat, userLng]);
```

### 분석 요청 및 점수 계산

#### 분석 API

```
POST /api/analyze
Content-Type: application/json

{
  "location": {
    "latitude": 37.4979,
    "longitude": 127.0276,
    "address": "서울 강남구 강남역"
  },
  "industry": "카페",
  "radiusMeters": 500
}

Response:
{
  "success": true,
  "analysisId": "analysis_uuid_123",
  "results": {
    "overallScore": 75,
    "overallGrade": "B+", // A+, A, B+, B, C+, C, D
    "recommendation": true, // 입지 추천 여부
    "metrics": {
      "marketVitality": {
        "score": 85,
        "weight": 30,
        "description": "이 지역은 주중/주말 상관없이 사람의 흐름이 활발합니다..."
      },
      "competitionIntensity": {
        "score": 65,
        "weight": 25,
        "description": "현재 반경 내에 경쟁사 15개가 있습니다..."
      },
      "survivalRate": {
        "score": 78,
        "weight": 20,
        "description": "2년 생존율 78%, 5년 생존율 62%..."
      },
      "residentialDensity": {
        "score": 72,
        "weight": 15,
        "description": "인구 밀도는 상위 30%입니다..."
      },
      "incomeLevel": {
        "score": 68,
        "weight": 10,
        "description": "평균 소득 수준은 상위 20%입니다..."
      }
    },
    "aiReport": "🤖 AI 분석 결과... (마크다운 형식의 긴 리포트)",
    "revenueSimulation": {
      "estimatedMonthlyRevenue": 8500000,
      "estimatedDailyCustomers": 120,
      "averageOrderValue": 6500,
      "operatingHours": "10:00 - 22:00",
      "assumptions": {
        "area": 36,
        "tables": 6,
        "seats": 18,
        "staff": 3,
        "estimatedRent": 2000000
      }
    },
    "timestamp": "2026-02-09T15:30:00Z"
  }
}
```

### 데이터 캐싱 전략

| 데이터 | 캐시 위치 | TTL | 갱신 트리거 |
|--------|---------|-----|-----------|
| **경쟁업체 목록** | 메모리 + IndexedDB | 1시간 | 반경/위치 변경 |
| **분석 결과** | IndexedDB + localStorage | 24시간 | 위치 재분석 |
| **지도 타일** | 브라우저 캐시 | 7일 | 자동 (Kakao) |
| **사용자 최근 검색** | localStorage | 30일 | 사용자 수동 삭제 |

---

## 🚀 Phase 2 추가 기능 (Additional Phase 2 Features)

### Feature 1: 트렌드 알림 (Trend Alerts)

#### 개요
선택한 지역/업종의 시장 트렌드 변화를 실시간으로 알림

#### 화면 설계

```
[📈 트렌드 탭]

현재 상권 추세:
━━━━━━━━━━━━━━━━━━━━━━

📊 지난 3개월 변화:

상권 활력도: ↑ +12%
  (유동인구 증가 추세)

경쟁 강도: → -2%
  (경쟁사 감소 추세)

생존율: ↑ +5%
  (신규 가맹점 증가)

━━━━━━━━━━━━━━━━━━━━━━

🔔 알림 설정:
[✓] 경쟁사 5개 이상 신규 진입
[✓] 상권 활력도 10% 이상 변화
[✓] 생존율 급락 (10% 이상)

저장
```

#### 기술 구현

```typescript
// Background Job: 일일 1회 트렌드 체크
// 간격: 매일 자정
// 방식: Server-Sent Events (SSE) 또는 푸시 알림

interface TrendAlert {
  id: string;
  type: 'market_vitality' | 'competition' | 'survival';
  changePercent: number;
  threshold: number;
  alertEnabled: boolean;
  lastUpdated: ISO8601;
}

// Push Notification
async function sendTrendAlert(userId, alert) {
  // FCM (Firebase Cloud Messaging) 또는
  // OneSignal을 통한 푸시 알림 발송

  const notification = {
    title: '📈 상권 변화 알림',
    body: `강남역 카페 상권 활력도가 ${alert.changePercent}% 상승했습니다!`,
    data: {
      analysisId: alert.analysisId,
      type: alert.type,
    },
  };

  await sendPushNotification(userId, notification);
}
```

---

### Feature 2: 예상 매출 시뮬레이션 (Revenue Simulation)

#### 개요
창업자가 다양한 시나리오에서 예상 매출을 계산해볼 수 있는 도구

#### 화면 설계

```
[💰 매출 예측]

기본 시뮬레이션 (강남역, 카페, 500m):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

월 예상 매출: 8,500,000원

상세 분석:
- 일 평균 고객: 120명
- 평균 주문액: 6,500원
- 오픈 시간: 10:00 - 22:00 (12시간)
- 예상 임대료: 2,000,000원/월

수익성 분석:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

월 매출: 8,500,000원
임대료: 2,000,000원 (23.5%)
식재비: 2,550,000원 (30%)
인건비: 2,550,000원 (30%)
기타비용: 850,000원 (10%)
─────────────────────────────
순이익: 550,000원 (6.5%)

현실성 점수: ⭐⭐⭐ (70점)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 시나리오 분석:

[기본 설정 수정] ▼

├─ 면적: 36m² (약 11평)
│  [축소: 25m²] [확대: 50m²]
│
├─ 좌석 수: 18개
│  [조정: 슬라이더]
│
├─ 일일 고객: 120명
│  [조정: 슬라이더]
│
├─ 평균 주문액: 6,500원
│  [조정: 슬라이더]
│
└─ 임대료: 2,000,000원
   [조정: 슬라이더]

[시뮬레이션 업데이트]
```

#### 기술 구현

```typescript
interface RevenueSimulation {
  // 입력값
  area: number; // m²
  seats: number;
  dailyCustomers: number;
  averageOrderValue: number;
  monthlyRent: number;
  operatingHours: { open: string; close: string };

  // 자동 계산값
  monthlyRevenue: number;
  monthlyExpenses: {
    rent: number;
    ingredients: number; // 30%
    labor: number; // 30%
    utilities: number; // 5%
    other: number; // 5%
  };
  netProfit: number;
  profitMargin: number;
  breakEvenMonths: number; // ROI 기간
  realismScore: number; // 0-100, 데이터 기반 신뢰도
}

// 실시간 시뮬레이션 업데이트
function calculateSimulation(params: InputParams): RevenueSimulation {
  const monthlyRevenue = params.dailyCustomers
    * params.averageOrderValue
    * 30;

  const monthlyExpenses = {
    rent: params.monthlyRent,
    ingredients: monthlyRevenue * 0.30,
    labor: monthlyRevenue * 0.30,
    utilities: monthlyRevenue * 0.05,
    other: monthlyRevenue * 0.05,
  };

  const totalExpenses = Object.values(monthlyExpenses).reduce((a, b) => a + b, 0);
  const netProfit = monthlyRevenue - totalExpenses;
  const profitMargin = (netProfit / monthlyRevenue) * 100;

  // 신뢰도 점수: 입력값과 실제 데이터 유사도
  const realismScore = calculateRealismScore(params);

  return {
    ...params,
    monthlyRevenue,
    monthlyExpenses,
    netProfit,
    profitMargin,
    breakEvenMonths: calculateBreakEven(netProfit),
    realismScore,
  };
}
```

#### 시나리오 저장 및 비교

```typescript
// 사용자가 여러 시나리오 저장 가능
interface ScenarioHistory {
  id: string;
  name: string; // "카페 - 강남역", "음식점 - 홍대" 등
  createdAt: ISO8601;
  simulation: RevenueSimulation;
}

// 시나리오 비교 화면
// 최대 3개 시나리오 나란히 표시 (막대 차트)
```

---

## 🔄 마이그레이션 전략 (Migration Strategy)

### Phase 1 → Phase 2 호환성

#### 유지 항목
```
✓ 로그인/인증 시스템 (무변경)
✓ History 페이지 기능 (개선하여 유지)
✓ 5가지 점수 계산 로직 (동일)
✓ 데이터 소스 (NPS/NTS/KOSIS 등, 동일)
✓ AI 리포트 생성 (LLM 인터페이스 동일)
```

#### 변경/확장 항목
```
⚠️ 네비게이션: 사이드바 → 바텀 네비게이션 (탭)
⚠️ 분석 플로우: 다단계 폼 → 지도 기반 인터랙션
⚠️ 결과 페이지: 탭 구조 유지하되 모바일 최적화
⚠️ 업종 선택: Phase 1의 드롭다운 → Phase 2의 칩 그리드
```

#### 폐기 항목
```
✗ 데스크톱 사이드바 레이아웃 (PC는 반응형으로 적응)
✗ Desktop-only 컴포넌트들
```

### 배포 전략

#### 1. Feature Flag (기능 플래그)

```typescript
// 사용자를 일부에만 새 UX 노출
const usePhase2UI = () => {
  const { user } = useAuth();

  // 30% 베타 그룹
  const isBeta = hashUserId(user.id) % 100 < 30;

  // 또는 명시적 옵트인
  const isOptedIn = user.preferences.phase2_beta === true;

  return isBeta || isOptedIn;
};

// 사용 예
{usePhase2UI() ? <Phase2Home /> : <Phase1Home />}
```

#### 2. A/B 테스트 세팅

| 그룹 | 비중 | UX | 목표 |
|------|------|-----|------|
| **Control (Phase 1)** | 50% | 기존 | 베이스라인 |
| **Test (Phase 2)** | 50% | 신규 모바일 | 전환율, 사용 시간 |

#### 3. 단계적 롤아웃

```
Week 1: 개발자 + QA 테스트 (100%)
  ↓
Week 2: 내부 베타 (10%, 직원 포함)
  ↓
Week 3: 공개 베타 (30%, 옵트인)
  ↓
Week 4: 캐나리 배포 (5%, 무작위)
  ↓
Week 5-6: 점진적 확대 (10% → 25% → 50%)
  ↓
Week 7+: 완전 배포 (100%, Phase 1 폐기 또는 유지)
```

#### 4. 롤백 계획

```
감시 지표 (모니터링):
- 크래시율 > 2%
- 분석 요청 실패율 > 5%
- 평균 응답시간 > 3초
- 사용자 만족도 점수 < 3.5/5

조건 만족 시 자동 롤백:
1. Feature flag 비활성화 (Phase 2 차단)
2. 사용자 안내 메시지
3. Phase 1로 자동 리다이렉트
4. 에러 로그 수집 및 분석
```

---

## 📈 성공 지표 (Success Metrics)

### 주요 KPI (Key Performance Indicators)

| 지표 | 목표 | 측정 방법 |
|------|------|---------|
| **모바일 전환율** | 45% → 65% | 분석 요청 완료 / 총 방문 |
| **단계별 드롭률** | 각 단계 <10% | 단계 진입 대비 완료 |
| **평균 사용 시간** | 3분 30초 → 4분 (자연스러운 흐름) | 세션 분석 |
| **오류율** | <1% | 분석 요청 실패 / 총 요청 |
| **앱 설치수** | +50% | PWA 설치 + 네이티브 앱 |
| **NPS (순추천고객지수)** | 40 → 55 | 정기 설문 |

### 사용자 경험 지표

| 지표 | 목표 | 측정 |
|------|------|------|
| **초기 로딩 시간** | <3초 | 첫 콘텐츠 페인트 (FCP) |
| **반경 업데이트 응답** | <500ms | 슬라이더 조정 → 마커 업데이트 |
| **페이지 전환 속도** | <200ms | 탭 클릭 → 콘텐츠 표시 |
| **Lighthouse Score** | 85+ | 성능, 접근성, SEO 합산 |
| **모바일 친화성** | 100점 | Google Mobile-Friendly Test |

### 비즈니스 지표

| 지표 | 목표 | 분석 주기 |
|------|------|---------|
| **분석 요청 수** | +40% (월 10만 → 14만) | 주간 |
| **재분석율** | 35% (다른 위치 재검색) | 주간 |
| **결과 저장율** | 50% (분석 완료 후 저장) | 주간 |
| **프리미엄 전환** | +25% (유료 상세 리포트) | 월간 |
| **사용자 유지율** | 30일: 45% | 월간 |

### 기술 지표

| 지표 | 목표 | 기준 |
|------|------|------|
| **API 응답시간** | p95 <500ms | 경쟁업체 조회 |
| **Kakao Map 초기화** | <2초 | 지도 로드 |
| **메모리 사용** | <50MB | 모바일 기기 |
| **배터리 소비** | <2% (10분 사용) | 모바일 기기 |
| **오프라인 기능** | 최근 분석 5개 액세스 가능 | PWA 캐싱 |

---

## 📅 로드맵 (Roadmap)

### Phase 2 개발 일정 (8주)

#### Week 1-2: 계획 및 설계 (Design Sprint)

```
Mon: 디자인 시스템 확정
Tue-Wed: 프로토타입 제작 (Figma)
Thu: 이해관계자 리뷰
Fri: 개발 스펙 최종화

산출물:
- UI/UX 디자인 완성본
- 컴포넌트 라이브러리
- 애니메이션 스펙
```

#### Week 2-3: 프론트엔드 기초 구축

```
Mon-Tue:
- 프로젝트 세팅
- Tailwind CSS + Framer Motion 통합
- 기본 레이아웃 컴포넌트 개발

Wed-Fri:
- Step 1-4 화면 개발
- 제스처 라이브러리 통합
- 반응형 테스트
```

#### Week 4: Step 5-6 개발

```
Mon-Tue:
- 반경 슬라이더 + 실시간 지도 업데이트
- 지도 마커 클러스터링

Wed-Fri:
- 업종 선택 UI
- 전환 애니메이션 구현 (4가지 옵션 시뮬레이션)
- 마이크로 인터랙션 추가
```

#### Week 5: Step 7-8 개발

```
Mon-Wed:
- 분석 결과 요약 카드
- 점수 카운트업 애니메이션
- 지표 시각화

Thu-Fri:
- AI 리포트 탭 개발
- 탭 내비게이션 구현
- 상세 정보 레이아웃
```

#### Week 6: 추가 기능 및 최적화

```
Mon-Tue:
- History 페이지 마이그레이션 (Phase 1 호환)
- 결과 저장 기능 구현

Wed:
- 트렌드 알림 UI (Phase 2.1 준비)
- 매출 시뮬레이션 계산 로직 (Phase 2.1 준비)

Thu-Fri:
- 성능 최적화
  - 번들 크기 분석 및 감소
  - 이미지 최적화
  - 코드 스플리팅
```

#### Week 7: 통합 테스트 및 QA

```
Mon-Wed: 통합 테스트
- E2E 테스트 (Cypress/Playwright)
- 사용성 테스트 (5명 베타 사용자)
- 성능 테스트 (lighthouse, WebPageTest)

Thu-Fri: 버그 수정 및 개선
- 발견된 이슈 우선순위 지정
- Hot fix 배포
```

#### Week 8: 배포 및 모니터링

```
Mon-Tue: Feature flag 활성화
- 10% 베타 사용자 대상 배포

Wed-Thu: 베타 피드백 수집
- Crash 모니터링
- 사용자 피드백 분석

Fri: 완전 배포 검토
- 배포 결정 (또는 연장 선택)
- Phase 2.1 로드맵 확정
```

### Phase 2.1 로드맵 (다음 4주)

```
Week 1: NTS 배치 API 연동 + NPS 샘플링 최적화
- NTS API 키 발급 (data.go.kr)
- checkBusinessStatus() 구현 (배치 조회)
- NPS 샘플 20→10 축소 (층화 표본)
- API 총 호출 49→30회로 최적화

Week 2: 트렌드 알림 기능
- 백그라운드 작업 설정
- 푸시 알림 통합 (FCM)

Week 3: 매출 시뮬레이션
- 시나리오 저장/로드
- 시나리오 비교 차트

Week 4: 사용자 피드백 기반 개선
```

---

## ⚠️ 리스크 및 완화 (Risks & Mitigation)

### 기술 리스크

| 리스크 | 영향 | 확률 | 완화 전략 |
|--------|------|------|---------|
| **Kakao Map SDK 성능 저하** | 지도 로딩 지연 | 중간 | 사전 성능 테스트, 대체 라이브러리 검토 (Mapbox, OpenStreetMap) |
| **API 응답 시간 초과** | 사용자 경험 악화 | 낮음 | API 캐싱 강화, 쿼리 최적화, CDN 도입 |
| **제스처 인식 오류** | 사용자 혼란 | 낮음 | 폭넓은 기기 테스트, 대체 입력 방식 제공 |
| **메모리 누수** | 앱 크래시 | 낮음 | 정기 메모리 프로파일링, 번들 분석 |
| **오프라인 모드 실패** | PWA 기능 제약 | 낮음 | Service Worker 철저한 테스트 |

### 비즈니스 리스크

| 리스크 | 영향 | 확률 | 완화 전략 |
|--------|------|------|---------|
| **사용자 만족도 저하** | NPS 급락 | 중간 | A/B 테스트, 초기 베타 피드백 수집, 사용성 테스트 |
| **모바일 전환율 미달** | 매출 목표 미충족 | 중간 | 초기 타겟층 집중, 마케팅 강화, UI/UX 개선 반복 |
| **데이터 정확성 의심** | 신뢰도 하락 | 낮음 | 데이터 소스 신뢰도 강조, 면책 조항 명시 |
| **경쟁 업체 진출** | 시장 점유율 감소 | 중간 | 기능 차별화 (AI 리포트), 사용자 경험 극대화 |

### 운영 리스크

| 리스크 | 영향 | 확률 | 완화 전략 |
|--------|------|------|---------|
| **일정 지연** | 시장 출시 후퇴 | 중간 | 2주 버퍼 확보, 주간 스프린트 리뷰 |
| **주요 팀원 부재** | 개발 중단 | 낮음 | 문서화, 지식 공유, 백업 담당자 지정 |
| **사용자 데이터 보안 사고** | 법적/평판 피해 | 낮음 | GDPR/개인정보보호법 준수, 정기 보안 감시 |

### 완화 전략 체계

```
1. 예방 (Prevention)
   - 철저한 테스트: 자동화 테스트 80% 커버리지
   - 설계 검토: 아키텍처 리뷰 2회 (초기, 중기)
   - 성능 예산: 초기 로딩 3초 이상 배포 불가

2. 감시 (Monitoring)
   - 실시간 대시보드: Sentry (에러), DataDog (성능)
   - 사용자 분석: GA4, Mixpanel
   - 비즈니스 지표: 자체 대시보드

3. 대응 (Response)
   - 사건 대응팀: 개발 + 운영 포함
   - 롤백 계획: 자동 + 수동 옵션
   - 의사소통: 사용자 공지, 상태 페이지

4. 학습 (Learning)
   - 사후 분석: 모든 부전 후 회의
   - 개선 항목: 다음 스프린트에 반영
```

---

## 📊 Phase 2 스코어링 모델 개선 (Scoring Model Reliability Improvements)

### 배경 및 필요성

현재 스코어링 모델(100점 만점, 5개 지표)의 **수집 데이터 중 40% 이상이 미활용** 상태입니다.
특히 NPS API에서 이미 수집 중이지만 사용하지 않는 필드(`crrmmNtcAmt`, `scsnDt`, 월별 추이 전체 데이터)를
활용하면 **추가 API 호출 없이** 모델 신뢰도를 획기적으로 개선할 수 있습니다.

```
핵심 원칙:
1. 이미 수집 중인 데이터의 지능적 활용 (추가 API 호출 최소화)
2. 정적 스냅샷 → 동적 추세 분석으로 전환
3. 단일 지표 의존 → 교차 검증으로 신뢰도 향상
```

---

### 🔴 Tier 1: 필수 구현 (추가 API 호출 0건)

#### 개선 1: 소득 수준 고도화 — NPS 급여 데이터 활용

**현재 문제**: 소득 수준(10점)이 아파트 거래가에만 의존 → 부동산 시장 변동, 임차 가구 비율에 따라 왜곡

**개선 방안**: NPS `crrmmNtcAmt`(국민연금 고지금액)으로 **실측 기반 추정 급여** 산출

```typescript
// 추정 평균 급여 계산
const estimatedSalary = crrmmNtcAmt / employeeCount / 0.09; // 고지금액 ÷ 직원수 ÷ 요율 9%
const salaryIndex = estimatedSalary / NATIONAL_AVG_SALARY; // 전국 평균 ~280만원

// 기존 아파트 가격 지수와 가중 평균
const priceIndex = avgAptPrice / NATIONAL_AVG_APT_PRICE; // 전국 평균 4.5억
const incomeScore = (salaryIndex * 0.6 + priceIndex * 0.4) * 10;
// 급여 60% + 부동산 40% → 근로자 중심 소매상권에 실측 급여 가중치 부여
```

| 구분 | Before | After |
|------|--------|-------|
| **데이터 소스** | 아파트 거래가만 | 국민연금 급여(60%) + 아파트 거래가(40%) |
| **강남역 (고소득)** | 10점 (만점) | 10점 (급여 320만 + 아파트 7억) |
| **대학가 (저임금)** | 8점 (아파트 4.2억) | 6점 (급여 200만 반영) |
| **임대 밀집 지역** | 9점 (아파트 비싼데 실소득 낮음) | 7점 (실측 급여로 보정) |

**구현 난이도**: ⭐ (매우 쉬움) · **추가 API 호출**: 0건 · **개발 기간**: 1-2일

---

#### 개선 2: 생존율 고도화 — 폐업 시점 동적 분석

**현재 문제**: 생존율(20점)이 정적 비율(활성/전체) → 5년간 천천히 폐업 vs 최근 3개월 급폐업 구분 불가

**개선 방안**: NPS `scsnDt`(탈퇴일)로 **폐업 시점 가중치** 적용

```typescript
// 폐업 시점별 가중치 (최근일수록 높은 페널티)
const recentClosures = {
  within3months: closures.filter(c => monthsAgo(c.scsnDt) <= 3).length,
  within6months: closures.filter(c => monthsAgo(c.scsnDt) <= 6).length,
};

// 기본 생존율 점수에 동적 조정 적용
const dynamicPenalty =
  -(recentClosures.within3months * 0.5)  // 최근 3개월: 건당 -0.5점
  -(recentClosures.within6months * 0.2); // 최근 6개월: 건당 -0.2점

const survivalScore = Math.max(0, baseScore + dynamicPenalty);
```

| 폐업 시점 | 가중치 | 의미 |
|-----------|--------|------|
| 최근 3개월 | 🔴 건당 -0.5점 | 급격한 시장 위축 신호 |
| 최근 6개월 | 🟠 건당 -0.2점 | 경기 둔화 신호 |
| 6-12개월 | 🟡 건당 -0.1점 | 정상 신진대사 범위 |
| 1년 이상 | 🟢 0점 | 장기적 안정성 |

**예시**: 동일 생존율 74%인 두 상권

```
상권 A: 폐업 30개 중 최근 3개월 0개, 6개월 1개
  → 동적 조정: -0.2점 → 거의 감점 없음 (안정적)

상권 B: 폐업 30개 중 최근 3개월 5개(!), 6개월 8개
  → 동적 조정: -(5×0.5) - (8×0.2) = -4.1점 → 심각한 경고
```

**구현 난이도**: ⭐⭐ (쉬움) · **추가 API 호출**: 0건 · **개발 기간**: 2-3일

---

#### 개선 3: 상권 활력도 보강 — 12개월 고용 추이 분석

**현재 문제**: 상권 활력도(30점)가 현재 시점 직원 수만 사용 → 성장/쇠퇴 추세 감지 불가

**개선 방안**: NPS 월별 추이 데이터 전체 활용 (현재 첫 항목만 사용 중)

```typescript
// 12개월 고용 추이 지수
const recent3m = average(employeeCounts.slice(0, 3));   // 최근 3개월 평균
const prev6m = average(employeeCounts.slice(6, 12));    // 6-12개월전 평균

const employmentTrend = (recent3m - prev6m) / prev6m;   // 성장률

// 상권 활력도에 추세 보너스/페널티 적용
const trendBonus =
  employmentTrend >= 0.10 ? +1.0 :   // ≥10% 성장: +1점
  employmentTrend >= 0.05 ? +0.5 :   // 5-10% 성장: +0.5점
  employmentTrend >= -0.05 ? 0 :     // ±5%: 변동 없음
  employmentTrend >= -0.15 ? -0.5 :  // 5-15% 감소: -0.5점
  -1.0;                               // >15% 감소: -1점

const vitalityScore = baseVitalityScore + (trendBonus * 2);
```

**시각화 추가** (프리미엄 리포트):
- 12개월 직원 수 라인 차트 (추세선 포함)
- "최근 3개월 고용 +21% ↗" 요약 태그

**구현 난이도**: ⭐⭐ (쉬움) · **추가 API 호출**: 0건 · **개발 기간**: 2-3일

---

#### 개선 4: NTS 사업자 3단계 상태 조회 — 생존율 정밀화 (NEW)

**현재 문제**: NPS 2단계(가입/탈퇴)로만 사업자 상태를 구분 → "휴업"과 "폐업"을 구분할 수 없어 생존율이 왜곡

**핵심 발견**: `data-go-mcp-servers` 레포 분석을 통해 **NTS(국세청) 사업자등록상태조회 API**를 발견.
한 번의 배치 호출로 최대 100개 사업자의 3단계 상태를 조회할 수 있습니다.

```
현재 (NPS만):
  wkplJnngStcd = 1 → 가입 (영업 중으로 추정)
  wkplJnngStcd = 2 → 탈퇴 (폐업으로 추정)   ← 휴업 구분 불가

개선 (NTS 추가):
  b_stt_cd = 01 → 계속사업자 (정상 영업)
  b_stt_cd = 02 → 휴업자 (일시 휴업)         ← 새로운 상태!
  b_stt_cd = 03 → 폐업자 (완전 폐업)
  + end_dt → 폐업일 (정확한 날짜)
  + tax_type → 과세유형 (일반/간이 구분)
```

**API 사양**:
```typescript
// POST https://api.odcloud.kr/api/nts-businessman/v1/status
// 한 번에 최대 100개 사업자 조회 가능 (배치)

interface NTSStatusRequest {
  b_no: string[];  // 사업자등록번호 배열 (최대 100개)
}

interface NTSStatusResult {
  b_no: string;        // 사업자등록번호
  b_stt: string;       // "계속사업자" | "휴업자" | "폐업자"
  b_stt_cd: string;    // "01" | "02" | "03"
  tax_type: string;    // 과세유형
  end_dt?: string;     // 폐업일 (YYYYMMDD)
}
```

**스코어링 로직 개선**:
```typescript
// NPS 검색 결과에서 사업자등록번호(bzowrRgstNo) 추출 → NTS 배치 조회
const businessNumbers = npsResults.map(b => b.bzowrRgstNo).filter(Boolean);
const statuses = await checkBusinessStatus(businessNumbers); // 1회 호출로 전체 조회

// 3단계 상태 집계
const statusCounts = {
  active: statuses.filter(s => s.b_stt_cd === '01').length,     // 계속사업자
  suspended: statuses.filter(s => s.b_stt_cd === '02').length,  // 휴업자
  closed: statuses.filter(s => s.b_stt_cd === '03').length      // 폐업자
};

// 생존율 점수 (기존: 단순 비율 → 개선: 3단계 가중)
const survivalRate = statusCounts.active / total;         // 순수 영업 비율
const suspensionRate = statusCounts.suspended / total;    // 휴업율 (새 지표!)

const survivalScore = (
  (survivalRate * 0.7) +                                  // 정상 영업 비율 70%
  (suspensionRate * 0.15) +                               // 휴업은 절반 가중
  ((1 - statusCounts.closed / total) * 0.15)              // 폐업 아닌 비율 15%
) * 20; // 20점 만점
```

**새로운 지표 — 휴업율**:
```
휴업율 = 휴업자 수 / 전체 사업자 수

해석:
  < 5%   🟢 안정적 상권
  5-15%  🟡 경기 변동 주의
  > 15%  🔴 상권 위축 위험
```

| 사례 | NPS 기존 | NTS 개선 | 차이 |
|------|---------|---------|------|
| 강남역 카페 20개 | 영업 14, 폐업 6 (생존율 70%) | 영업 14, 휴업 3, 폐업 3 (실제 생존율 85%) | 휴업을 폐업으로 오인 → 15%p 과소평가 수정 |
| 홍대 음식점 20개 | 영업 10, 폐업 10 (생존율 50%) | 영업 10, 휴업 2, 폐업 8 (실제 생존율 60%) | 휴업 식별 → 위험도 재평가 |

**API 키 요건**: data.go.kr에서 `국세청_사업자등록정보 진위확인 및 상태조회 서비스` 별도 신청 필요

**구현 난이도**: ⭐ (매우 쉬움) · **추가 API 호출**: +1건 (배치) · **개발 기간**: 1-2일

---

#### 개선 5: NPS 샘플링 최적화 — API 호출 40% 감소 (NEW)

**현재 문제**: NPS 상세/기간별 조회가 사업장당 2회 × 20개 = 40회 호출 → 전체 49회 중 83% 차지

**개선 방안**: 통계적 대표성을 유지하면서 샘플 20→10으로 축소

```typescript
// 기존: 20개 전체 상세 조회
const details = await Promise.all(
  businesses.slice(0, 20).map(b => getBusinessDetail(b.seq))  // 20 calls
);

// 개선: 상위 5개 + 무작위 5개 = 10개 샘플
const topByEmployees = sortByEmployees(businesses).slice(0, 5);
const remaining = businesses.filter(b => !topByEmployees.includes(b));
const randomSample = shuffle(remaining).slice(0, 5);
const sample = [...topByEmployees, ...randomSample]; // 대표성 확보

const details = await Promise.all(
  sample.map(b => getBusinessDetail(b.seq))  // 10 calls (50% 감소)
);
```

**통계적 근거**:
- 10개 샘플: 95% 신뢰구간, 오차범위 ≈ ±20%
- 상위 5개 (규모순) + 무작위 5개 → 층화 표본으로 편향 최소화
- 사용자 체감 차이 없음 (점수는 평균/비율 기반)

**API 호출 최적화 결과**:
```
           현재         개선 후      절감
NPS 검색    1             1           -
NPS 상세    20            10          -10
NPS 기간별  20            10          -10
NTS 배치    0             1           +1
기타        8             8           -
────────────────────────────────────────
합계        49            30          -19 (39% 감소)
```

**구현 난이도**: ⭐ (매우 쉬움) · **개발 기간**: 0.5일

---

### 🟡 Tier 2: 권장 구현 (추가 API 호출 +4~8건)

#### 개선 4: 인구 동향 분석 — 전입/전출 추세

KOSIS `DT_1B04005N` (인구 이동) 데이터로 **주거 밀도(15점)에 성장 방향성** 추가

```typescript
// 인구 순이동 추세
const recentNetMigration = sum(immigration.slice(0, 3)) - sum(emigration.slice(0, 3));
const prevNetMigration = sum(immigration.slice(6, 12)) - sum(emigration.slice(6, 12));
const migrationTrend = (recentNetMigration - prevNetMigration) / Math.abs(prevNetMigration);

// 주거 밀도 동적 조정
const migrationBonus =
  migrationTrend > 0.30 ? +2 :   // 강한 인구 유입
  migrationTrend > 0.10 ? +1 :   // 온건 유입
  migrationTrend > -0.10 ? 0 :   // 안정
  migrationTrend > -0.30 ? -1 :  // 온건 유출
  -2;                              // 강한 유출

const residentialScore = baseResidentialScore + migrationBonus;
```

**기대 효과**: 신도시 개발 지역의 "숨은 기회" 포착, 인구 유출 지역 조기 경고

**추가 API 호출**: KOSIS +3~5건 (분기별 캐싱) · **개발 기간**: 3-4일

---

#### 개선 5: 연령대별 산업 매칭 — 고객층 적합도

KOSIS `DT_1IN1502` (연령별 인구)로 **업종과 지역 연령 구조 매칭**

```typescript
// 업종별 최적 연령대 정의
const OPTIMAL_AGE_MAP = {
  '카페': { range: '20-39', threshold: 0.25 },
  '음식점': { range: '20-49', threshold: 0.50 },
  '의원/약국': { range: '40-79', threshold: 0.35 },
  '편의점': { range: 'all', threshold: 0 },
};

// 연령 적합도 → 경쟁 강도 보정에 활용
const ageRatio = targetAgePopulation / totalPopulation;
const nationalAvgRatio = NATIONAL_AGE_RATIO[industry];
const ageFitScore = ageRatio / nationalAvgRatio; // >1이면 적합
```

| 사례 | 업종 | 지역 연령 특성 | 적합도 |
|------|------|---------------|--------|
| 강남역 카페 | 카페 | 20-39대 62% | 🟢 매우 적합 (+0.5점) |
| 종로 한의원 | 의원 | 50-70대 48% | 🟢 매우 적합 (+0.5점) |
| 대학가 고급 레스토랑 | 음식점 | 20대 65%, 저소득 | 🟡 연령 적합, 소득 부적합 |

**추가 API 호출**: KOSIS +1~3건 · **개발 기간**: 4-5일

---

### 🟢 Tier 3: 향후 검토

| 개선 사항 | 데이터 | 효과 | 비고 |
|-----------|--------|------|------|
| 프랜차이즈 밀도 | NPS `wkplStylDvcd` | 법인/개인 비율로 경쟁 유형 분석 | 이미 수집 중, 구현 쉬움 |
| 세밀 업종 분류 | NPS `wkplIntpCd` | "음식점 포화지만 중식은 기회" | 사용자 요청 시 우선 |
| 부동산 가격 추이 | 실거래 API 다중 월 | 6-12개월 시세 트렌드 | API +5건 추가 |
| ~~NTS 3상태 구분~~ | ~~NTS API~~ | ~~영업/휴업/폐업 정확 구분~~ | ✅ **Tier 1로 승격 (개선 4)** |

---

### API 호출량 영향도 (MCP 분석 반영 업데이트)

```
변경 전:  49회/분석 (NPS 20개 전체 상세조회 기준)

변경 후 (Phase 2 적용):
  Kakao 지도 검색     1회   (변동 없음)
  NPS 검색            1회   (변동 없음)
  NPS 상세           10회   (20→10 샘플링 축소, -10)
  NPS 기간별         10회   (20→10 샘플링 축소, -10)
  NTS 배치 상태       1회   (신규 추가, 20개 한번에 조회)
  부동산 시세          1회   (변동 없음)
  KOSIS 인구          2회   (변동 없음)
  서울 골목            3회   (변동 없음)
  Claude Haiku        1회   (변동 없음)
  ─────────────────────────
  합계:              30회   (49→30, 39% 감소)

Phase 2 + Tier 2:
  KOSIS 인구이동     +3~5회
  KOSIS 연령별       +1~3회
  ─────────────────────────
  합계:              34~38회 (여전히 기존 49회보다 적음)

✅ NTS 배치 1회 추가로 3단계 상태 확보 (생존율 정밀화)
✅ NPS 샘플링 10개로 축소해도 통계적 유의성 유지 (95% 신뢰구간)
✅ 총 API 호출 39% 감소 → 응답 속도 개선 + 일일 호출 제한 여유
```

---

### 개선 전/후 비교 사례

#### 사례: 신촌 대학가 음식점

```
Before (현재 모델):
  소득 수준: 8점 (아파트 4.2억 기준)
  생존율: 10점 (72% 정적 비율)
  상권 활력도: 22점 (현재 시점만)
  총점: 69점 — "소득 낮고 생존율 저조. 진입 비추천"

After (Phase 2.1 개선):
  소득 수준: 6점 (급여 200만 반영, 대학가 저임금 특성 정확 포착)
  생존율: 13점 (최근 폐업 3개월 이내=0건, 정상 범위 → 페널티 없음, +3점)
  상권 활력도: 25점 (고용 추이 +25% 반영, +3점)
  총점: 73점 — "청년층 고집중, 고용 폭발 성장 중. 카페/음식점 최적"

→ 동일한 상권인데 "비추천"에서 "가능성 있음"으로 평가가 역전
→ 이유: 정적 숫자만 보면 안 좋지만, 추세를 보면 급성장 중
```

---

### 구현 로드맵

| 단계 | 기간 | 내용 | 산출물 |
|------|------|------|--------|
| **Phase 2.1** | 2주 | NTS 배치 API 연동 + NPS 샘플링 최적화 + 소득 고도화 + 생존율 동적화 + 고용 추이 | 개선된 스코어링 엔진 (30 calls, 3단계 상태) |
| **Phase 2.2** | 3주 | 인구 동향 + 연령 매칭 | KOSIS 파이프라인 + 적합도 알고리즘 |
| **Phase 2.3** | 2주 | 프랜차이즈/업종 세분화/가격 추이 | 선택적 고급 분석 |

---

## 🤖 Phase 2 AI 리포트 프롬프트 개선 (AI Report Prompt Enhancement)

### 배경 및 필요성

현재 AI 리포트 프롬프트 완성도는 **B+ (75점)**. Phase 2의 새로운 UX(AI 타이핑 효과, 블러 게이트, 데이터 신뢰도 시스템)에 맞춘 프롬프트 재설계가 필요합니다.

```
Phase 2 프롬프트 개선의 3대 목표:

1. 신뢰성 강화: 점수 공식·데이터 출처·시점 명시 → 투명한 분석
2. 다양성 증대: 톤 변화·표현 풀 확대·업종 맞춤 → 매번 다른 느낌의 리포트
3. UX 호환성: 구조화된 출력 → AI 타이핑 효과·블러 게이트와 완벽 연동
```

---

### 🔴 High Priority: 즉시 적용 (프롬프트만 수정, 코드 변경 최소)

#### P4: 데이터 출처 + 시점 명시

AI가 "이 데이터는 어디서 왔고, 언제 것인지" 알아야 정확한 맥락을 전달할 수 있습니다.

```
현재:
  "동일 업종 사업장: 45개"

개선:
  "동일 업종 사업장: 45개 (국민연금공단 사업장 데이터, 2026년 1월 기준)"
  "평균 아파트 거래가: 8.5억 (국토교통부 실거래가, 2025년 11월 거래 기준)"
  "총 인구: 544,873명 (통계청 KOSIS, 2025년 연간 데이터)"
```

**프롬프트 추가 지시**:
```
## 데이터 출처 규칙
- 숫자를 언급할 때 반드시 출처와 기준 시점을 괄호로 포함해.
  ✅ "국민연금 데이터(2026년 1월 기준)를 보면, 이 반경 내 같은 업종 사업장이 45개예요."
  ❌ "이 반경 내 같은 업종 사업장이 45개예요."
```

**기대 효과**: 사용자가 "근거가 있구나"라는 신뢰감 형성 · 데이터 신뢰도 시스템(🟢🟡🔴)과 자연스러운 연결

---

#### P6: 점수 산출 근거 요약 전달

AI가 점수의 의미를 정확히 이해해야 해석 품질이 올라갑니다.

```
## 점수 산출 기준 (AI에게 제공)
- 상권 활력도(30점): 신규 창업 비율 30% + 평균 직원 규모 40% + 활성 비율 30%
- 경쟁 강도(25점): 반경 내 동일 업종 밀도. 밀도 낮을수록 높은 점수(역비례)
  · 업종별 기준 밀도: 치킨 8개/km², 카페 15개/km², 한식 12개/km², 편의점 5개/km²
- 생존율(20점): 활성/(활성+폐업). 50%이하=0점, 90%이상=만점
- 주거 밀도(15점): 아파트 거래 건수 40% + 세대수 35% + 인구수 25%
- 소득 수준(10점): 추정 급여 60% + 아파트 거래가 40%. 전국 평균 대비 비율

이 공식을 바탕으로, 각 점수가 왜 이렇게 나왔는지 구체적으로 설명해.
예시: "경쟁 강도가 15점인 이유는, 반경 500m 내 동일 업종이 22개로
       카페 기준 밀도(15개/km²)를 이미 초과했기 때문이에요."
```

---

#### P8: detailedAnalysis 구조화 (4문단 고정)

**현재**: "3~5문단 자유 형식" → AI 타이핑 효과에 예측 불가능한 길이, 일관성 부족

**개선**: 문단별 역할 고정 → 타이핑 시퀀스와 완벽 호환

```
## 상세 분석 구조 (반드시 이 순서로 4문단 작성)

1문단 — [상권 종합 진단]
  "이 동네는 ~~한 성격의 상권이에요" 로 시작.
  상권의 큰 그림을 그려줘. 2-3문장.

2문단 — [핵심 지표 해석]
  가장 중요한 2~3개 지표를 깊이 있게 해석. 숫자를 반드시 인용.
  "활력도가 85점인 건 최근 2년 내 새로 오픈한 가게가 전체의 48%나 되기 때문이에요."

3문단 — [실전 전략]
  이 데이터 바탕으로 실제 창업 시 접근 방법. 구체적이고 실행 가능한 것만.
  오픈 시간, 메뉴 구성, 마케팅 채널, 초기 투자 전략 등.

4문단 — [데이터 한계 안내]
  이 리포트가 공공 데이터 기반 참고 자료임을 안내.
  현장 답사·전문가 상담 병행 권고. 1-2문장으로 간결하게.
```

**타이핑 효과 호환**: 각 문단이 독립적 → 문단 단위로 타이핑 완료 후 다음 문단 시작

---

#### P11: 강점/위험에 데이터 근거 인라인 필수

**현재**: "주변 배후 수요가 탄탄해요" (근거 불명)

**개선**:
```
## 근거 규칙
- strengths, risks에는 반드시 근거 수치를 괄호로 포함해.
  ✅ "주변 배후 수요가 탄탄해요 (인구 54만명, 아파트 거래 120건/월)"
  ✅ "경쟁이 치열해요 (반경 500m 내 동일 업종 22개, 밀도 기준 초과)"
  ❌ "주변 배후 수요가 탄탄해요"
  ❌ "경쟁이 좀 있어요"
```

---

### 🟡 Medium Priority: Phase 2 초기 적용

#### P1: 점수 구간별 감정 톤 세분화

**현재**: 4단계(80/60/40) → 82점과 98점이 같은 톤

**개선**: 6단계 톤 가이드

```
## 점수별 톤 가이드

90~100점 — 확신 있게 밝은 톤:
  "여기 진짜 좋은 자리예요. 데이터가 거의 다 초록불이거든요."

80~89점 — 긍정적이지만 한두 가지 주의:
  "전체적으로 괜찮아요. 다만 이 부분은 좀 신경 쓰시면 더 좋겠어요."

70~79점 — 가능성은 있지만 전략 필요:
  "나쁘진 않은데, 그냥 들어가면 위험할 수 있어요. 전략이 필요해요."

60~69점 — 조심스러운 톤:
  "솔직히 반반이에요. 이걸 커버할 수 있는 확실한 무기가 있으셔야 해요."

40~59점 — 걱정되는 톤:
  "데이터만 보면 쉽지 않아요. 정말 하고 싶으시다면 이건 꼭 해결하셔야 해요."

0~39점 — 단호하지만 대안 제시:
  "이 자리에서 이 업종은 솔직히 추천 못 해요. 차라리 이런 방향은 어떨까요?"
```

---

#### P2: 부정 표현 다양화 가이드

**현재**: "솔직히 좀 걱정되는 부분이에요"만 반복

**개선**:
```
## 부정 표현 풀 (반복 금지, 심각도별 선택)

경미한 우려:
  "이 부분은 조금 아쉬워요"
  "살짝 신경 쓰이는 포인트가 있어요"
  "완벽하진 않지만 치명적이진 않아요"

중간 우려:
  "여기는 좀 고민이 필요해요"
  "이 부분은 전략 없이 들어가면 힘들 수 있어요"
  "데이터가 좀 걱정스러운 신호를 보내고 있어요"

심각한 우려:
  "솔직히 이건 꽤 부담스러운 수치예요"
  "이 숫자는 상당히 불리해요. 무시하기 어려운 수준이에요"
  "현실적으로 이 조건에서 성공하기 쉽지 않아요"

규칙: risks 3개를 쓸 때 3개 모두 다른 표현을 사용해. 절대 반복하지 마.
```

---

#### P3: 업종별 분석 관점 차이 명시

```
## 업종별 분석 포커스

배달 중심 업종 (치킨, 피자, 중식):
  → 주거 밀도 > 유동인구. 반경 3km 배달 커버리지가 핵심.
  → "배달앱 내 리뷰 경쟁력"과 "배달 수수료 대비 마진율"을 언급해.

방문형 업종 (카페, 미용실, 음식점):
  → 유동인구 > 주거 밀도. 역세권/오피스 근접이 강점.
  → "점심 시간대 오피스 수요"나 "주말 데이트 코스" 같은 시나리오로 설명해.

생필품 업종 (편의점, 세탁소):
  → 주거 밀도가 거의 전부. 500m 이내 경쟁을 특히 강조해.

전문 서비스 (학원, 병원):
  → 상권보다 접근성과 주차. 인구 연령대 구성이 핵심.
  → "이 동네 40-60대가 48%로 의원 수요가 탄탄해요" 식으로 연결해.
```

---

#### P5: 누락 데이터 명시적 전달

**현재**: KOSIS/골목상권 없으면 섹션 자체 생략 → AI가 "데이터 없음" 사실을 모름

**개선**:
```
## 데이터 누락 시 표기 규칙

데이터가 없으면 숨기지 말고 명시해:

### 인구 현황
- 데이터 없음 (KOSIS 조회 실패 또는 비서울 지역)

### 서울시 골목상권 분석
- 해당 없음 (서울 외 지역)

AI는 이를 인지하고 리포트에 반영:
"이 지역은 서울시 골목상권 빅데이터가 제공되지 않아서,
 추정매출이나 소비 패턴은 NPS 데이터 중심으로 분석했어요."
```

---

#### P9: summary 길이 50자 → 80자 확장

```
현재 (50자): "강남역 치킨, 경쟁 치열하나 배후수요 좋음"
개선 (80자): "강남역 근처 치킨 창업, 경쟁 업체 22개로 치열하지만
             주거 밀도와 소득 수준이 상위 10%라 차별화 전략만 있으면 가능성 있어요"
```

---

#### P13: 골목상권 매출 해석 가이드 구체화

**현재 문제**: `분기매출 ÷ 3` = 개별 점포 매출로 오해 가능 (실제로는 상권 전체 합산)

```
## 골목상권 매출 해석 규칙

- 골목상권 추정매출은 해당 업종 상권 전체의 합산 매출. 개별 점포 매출이 아님.
- 점포당 추정 월매출 = (분기 추정매출 ÷ 3) ÷ 해당 업종 점포수
- 이 수치는 "평균적인 점포가 벌 수 있는 금액"의 추정치로 안내해.
  단, "실제 매출은 입지, 메뉴, 마케팅에 따라 크게 달라질 수 있어요"라는 단서를 꼭 붙여.

예시:
  ✅ "이 상권 카페 전체 분기 매출이 약 3.6억이고, 카페가 12개니까
      평균 점포당 월 1,000만원 정도 매출이 추정돼요.
      다만 이건 평균이라 실제로는 위치와 운영에 따라 크게 달라져요."
  ❌ "월 예상 매출은 1.2억입니다."
```

---

#### P14: 상권변화지표 해석 개선

```
## 상권변화지표 4등급 해석 가이드

HH (다이나믹):
  "가게가 많이 열리기도 하고 닫히기도 해요. 경쟁이 치열하지만 수요도 있다는 뜻이에요.
   차별화 포인트가 확실하면 기회가 있어요."

HL (상위 안정):
  "기존 가게들이 오래 살아남는 상권이에요. 좋은 신호지만,
   신규 진입자에게는 기존 업체와의 경쟁이 부담될 수 있어요."

LH (축소):
  "새로 여는 곳보다 닫는 곳이 많아요. 상권이 위축되고 있는 신호예요.
   이 추세가 계속되면 위험해요."

LL (정체):
  "변화가 거의 없는 상권이에요. 안정적이라고도 볼 수 있지만,
   새로운 수요가 유입되지 않고 있다는 뜻이기도 해요."
```

---

### 🟢 Low Priority: 선택적 적용

#### P7: 출력 스키마 유연화

```typescript
// 현재: 고정 3개
strengths: z.array(z.string()),

// 개선: 1~5개 유연
strengths: z.array(z.string()).min(1).max(5),
risks: z.array(z.string()).min(1).max(5),
recommendations: z.array(z.string()).min(2).max(4),
```

프롬프트 지시: "데이터에 근거가 있는 것만 작성해. 억지로 개수를 채우지 마. 최소 1개, 최대 5개."

---

#### P12: AI 신뢰도 레벨 필드 추가

```typescript
// 출력 스키마에 추가
confidenceLevel: z.number().min(1).max(5),
// 5: 모든 지표 데이터 충분 + 일관됨
// 4: 대부분 충분, 일부 누락
// 3: 핵심 데이터 있지만 보조 부족
// 2: 부분적, 판단에 불확실성
// 1: 매우 부족, 참고 수준만

// UI: "데이터 신뢰도: ★★★★☆"
```

---

### 새로운 출력 스키마 (Phase 2)

```typescript
const ReportSchema = z.object({
  verdict: z.enum(["추천", "조건부 추천", "주의", "비추천"]),
  summary: z.string().max(80),  // 50→80자 확장
  confidenceLevel: z.number().min(1).max(5),  // 신규 추가
  strengths: z.array(z.string()).min(1).max(5),  // 고정 3 → 유연 1~5
  risks: z.array(z.string()).min(1).max(5),
  recommendations: z.array(z.string()).min(2).max(4),
  detailedAnalysis: z.object({  // 자유형식 → 구조화 4문단
    marketDiagnosis: z.string(),       // 상권 종합 진단
    keyMetricsAnalysis: z.string(),    // 핵심 지표 해석
    actionStrategy: z.string(),        // 실전 전략
    dataLimitations: z.string(),       // 데이터 한계 안내
  }),
});
```

---

### AI 타이핑 효과와의 통합

Phase 2의 순차적 타이핑 UX에 구조화된 출력이 어떻게 매핑되는지:

```
타이핑 시퀀스:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[0.0s] 종합 점수 카운트업 (0→75, 1.5초)
[1.5s] verdict 텍스트 타이핑 ("조건부 추천")
[2.0s] summary 타이핑 (80자, 30ms/글자 = ~2.4초)
[4.5s] ─── 구분선 ───

[5.0s] 🟢 상권 활력도 fadeIn → 점수 카운트업 → AI 코멘트 타이핑
[7.5s] 🟢 경쟁 강도 fadeIn → 점수 카운트업 → AI 코멘트 타이핑
[10.0s] 🟢 생존율 fadeIn → 점수 카운트업 → AI 코멘트 타이핑

[12.0s] ▓▓▓ 블러 게이트 트리거 ▓▓▓

[결제 후]
[12.5s] 블러 해제 → 주거 밀도 타이핑
[15.0s] 소득 수준 타이핑
[17.0s] detailedAnalysis.marketDiagnosis 타이핑
[19.0s] detailedAnalysis.keyMetricsAnalysis 타이핑
[21.0s] detailedAnalysis.actionStrategy 타이핑
[23.0s] detailedAnalysis.dataLimitations 타이핑
[24.0s] "분석이 완료되었어요! 📊"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

포인트:
- 구조화된 4문단 → 각 문단 단위로 타이핑 완료 후 다음 시작
- 블러 게이트 위치가 명확 (strengths/risks 후, detailedAnalysis 전)
- 각 섹션 길이 예측 가능 → 부드러운 자동 스크롤
```

---

### Before / After 리포트 비교

#### Before (현재 B+ 수준)

```json
{
  "verdict": "조건부 추천",
  "summary": "강남역 카페, 경쟁 치열하나 배후수요 좋음",
  "strengths": [
    "주변 유동인구가 많아요",
    "소득 수준이 높은 편이에요",
    "교통이 편리해요"
  ],
  "risks": [
    "솔직히 좀 걱정되는 부분이에요 (경쟁)",
    "솔직히 좀 걱정되는 부분이에요 (임대료)",
    "솔직히 좀 걱정되는 부분이에요 (생존율)"
  ],
  "detailedAnalysis": "이 상권은 카페 창업에 적합한 조건을 갖추고 있습니다..."
}
```

#### After (개선 A- 수준)

```json
{
  "verdict": "조건부 추천",
  "summary": "강남역 카페, 반경 500m 내 동종 22개로 경쟁 치열하지만 주거 밀도와 소득 상위 10%라 차별화 전략 있으면 승산 있어요",
  "confidenceLevel": 4,
  "strengths": [
    "배후 수요가 탄탄해요 (인구 54만명, 아파트 거래 120건/월, 국민연금 기준 평균 급여 320만원)",
    "최근 3개월 고용이 18% 증가하는 성장 상권이에요 (NPS 월별 추이, 2026년 1월 기준)",
    "20-30대 비율이 62%로 카페 최적 고객층이 집중되어 있어요 (KOSIS 연령별 인구)"
  ],
  "risks": [
    "반경 500m 내 카페가 22개로 밀도 기준(15개/km²) 초과 상태예요. 시그니처 메뉴 없이는 어려워요",
    "평균 임대료가 전용 10평 기준 월 180만원대로 손익분기까지 월 매출 800만원 이상이 필요해요",
    "최근 6개월 동일 업종 폐업 3건 발생. 경쟁 탈락 속도가 빠른 상권이에요"
  ],
  "recommendations": [
    "프리미엄 차별화 필수: '공간 경험', '시그니처 음료', 'SNS 바이럴' 중 1가지 이상 확보하세요",
    "오픈 후 3개월은 인스타그램 광고에 월 200만원 이상 투자 권장. 초기 인지도가 생존 좌우해요",
    "금요일 17-21시가 매출 피크(골목상권 데이터). 이 시간대 집중 운영 전략 세우세요"
  ],
  "detailedAnalysis": {
    "marketDiagnosis": "강남역 일대는 일일 유동인구 30만명의 초고밀도 상업지구예요. 직장인·대학생·쇼핑객이 집중되면서 카페 수요는 꾸준하지만, 그만큼 공급도 많은 '다이나믹한' 상권이에요.",
    "keyMetricsAnalysis": "활력도가 85점으로 높은 이유는 최근 2년 내 신규 오픈한 가게가 48%나 되기 때문이에요. 반면 경쟁 강도는 65점인데, 반경 500m에 카페 22개는 기준 밀도(15개/km²)를 46% 초과한 수준이거든요. 다만 주거 밀도 14점, 소득 수준 10점 만점은 이 경쟁을 버틸 수 있는 구매력이 있다는 뜻이에요.",
    "actionStrategy": "30대 여성이 주 소비층(골목상권 데이터)이니까, 인스타그램 감성의 인테리어와 시그니처 음료 조합이 핵심이에요. 금요일 저녁이 매출 피크니까 주말 전 재고 확보하시고, 오피스 점심 수요를 잡으려면 11-13시 세트 메뉴 전략도 고려하세요.",
    "dataLimitations": "이 리포트는 국민연금공단·국토교통부·통계청·서울시 공공데이터를 기반으로 작성했어요. 실제 매출은 입지 미시 조건, 운영 역량에 따라 크게 달라지니 현장 답사와 전문가 상담을 꼭 병행하세요."
  }
}
```

**개선 포인트 요약**:
- ✅ 모든 수치에 데이터 출처와 시점 명시
- ✅ 톤이 점수 구간(70-79점)에 맞게 "가능성은 있지만 전략 필요" 톤
- ✅ 부정 표현이 3가지 모두 다름 (밀도 초과 / 임대료 부담 / 폐업 속도)
- ✅ 업종 맞춤 (카페 → SNS, 시그니처 음료, 30대 여성)
- ✅ detailedAnalysis가 4문단 구조화 → 타이핑 효과와 완벽 호환
- ✅ 골목상권 매출 해석이 정확 (피크 시간/요일 + 소비층)

---

### 구현 계획

| 단계 | 기간 | 내용 | 난이도 |
|------|------|------|--------|
| **v1.0** (1주차) | 3-4시간 | P4 + P6 + P8 + P11 (프롬프트만 수정) | ⭐ |
| **v1.1** (2-3주차) | 5시간 | P1 + P2 + P3 + P5 (톤·표현·업종·누락) | ⭐ |
| **v1.2** (4주차) | 4시간 | P9 + P13 + P14 + P7 + P12 (스키마·해석) | ⭐⭐ |

> **핵심**: P4+P6+P8+P11 (v1.0)만 적용해도 리포트 등급 B+(75점) → A-(85점) 상승 기대.
> 모두 프롬프트 텍스트 수정만으로 구현 가능하며, 코드 변경은 스키마 유연화(P7) 정도.

---

## 🧠 Phase 3 비전: AI 컨설턴트 모드 (MCP 기반 확장)

> **Phase 2**는 결정적 스코어링 + AI 리포트의 고도화입니다.
> **Phase 3**는 사용자가 AI와 자유롭게 대화하며 상권을 탐색하는 **에이전트형 서비스**로의 확장입니다.

### 배경: 왜 MCP인가?

**MCP (Model Context Protocol)**는 AI 모델이 외부 도구(API, 데이터베이스 등)를 직접 호출할 수 있게 하는 개방형 프로토콜입니다.
`data-go-mcp-servers` 오픈소스 레포 분석 결과, 공공데이터포털 API를 MCP 도구로 래핑한 서버가 이미 존재하며,
NPS/NTS API가 우리 서비스와 동일한 엔드포인트를 사용합니다.

**Phase 2에서 MCP를 쓰지 않는 이유:**
```
1. 아키텍처 미스매치: 현재는 "웹 서버 → API → 결정적 스코어링" 구조
   → MCP는 "AI 에이전트 ↔ 도구" 프로토콜로 용도가 다름
2. 불필요한 레이어: Next.js → MCP Client → MCP Server(Python) → API (3 hops)
   → 현재의 Next.js → API (1 hop)가 더 효율적
3. 스코어링은 결정적이어야 함: 같은 입력 → 항상 같은 점수 (사용자 신뢰)
   → AI가 "어떤 API를 호출할지" 결정하는 구조가 아님
```

**Phase 3에서 MCP가 빛나는 이유:**
- 사용자 질문이 자유형 → AI가 어떤 데이터를 가져올지 판단해야 함
- 고정 공식이 아닌 맥락 기반 분석 → AI 에이전트의 강점
- 여러 API를 조합한 탐색적 분석 → MCP 도구 호출의 장점

---

### Phase 3 서비스 모델: AI 컨설턴트

#### 현재 (Phase 2) vs 미래 (Phase 3)

```
Phase 2 — 정형 분석:
  사용자: "강남역 카페 분석해줘"
  서비스: [고정 흐름] 위치→반경→업종→5지표 점수→리포트
  결과: 점수 75점, 조건부 추천 (매번 동일한 포맷)

Phase 3 — AI 컨설턴트:
  사용자: "강남역에서 카페 vs 음식점 뭐가 나을까?"
  AI: [MCP 도구 활용]
    → NPS 도구: 카페 20개 + 음식점 20개 각각 조회
    → NTS 도구: 양쪽 생존율 비교
    → KOSIS 도구: 연령대별 소비 패턴 확인
    → FSC 도구: 프랜차이즈 본사 재무건전성 체크
  결과: "카페는 포화 상태지만 음식점은 점심 수요 대비 부족합니다.
         특히 한식은 20-30대 직장인이 62%인 이 지역에서 기회가 있습니다.
         다만 평균 임대료 320만원 대비 예상 매출을 고려하면..."
```

#### 자유 질문 예시

| 질문 유형 | 예시 | AI가 호출하는 MCP 도구 |
|-----------|------|----------------------|
| **비교 분석** | "이 동네에서 베이커리 vs 디저트 카페?" | NPS ×2, NTS ×2, KOSIS |
| **트렌드 탐색** | "최근 6개월간 이 상권 변화가 어때?" | NPS (기간별), NTS (휴업 추이) |
| **입지 확장** | "여기 성공하면 2호점은 어디가 좋을까?" | NPS (인근 3개 동), KOSIS, 부동산 |
| **리스크 진단** | "이 동네가 위험해 보이는데 왜 그런거야?" | NPS (폐업 추이), NTS (휴업율), 골목상권 |
| **재무 시뮬** | "월 300만원 벌려면 어떤 업종이 가능해?" | NPS + 골목상권 (업종별 매출) |

---

### 기술 아키텍처 (Phase 3)

```
┌──────────────────────────────────────────────────────────────┐
│                    Phase 3 아키텍처                            │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  사용자 자유 질문                                              │
│       ↓                                                        │
│  ┌──────────────────────────────────────┐                     │
│  │     Claude Sonnet (AI 에이전트)       │                     │
│  │     - 질문 의도 파악                  │                     │
│  │     - MCP 도구 선택/조합              │                     │
│  │     - 데이터 해석/분석                │                     │
│  │     - 맥락 기반 답변 생성             │                     │
│  └────────────┬─────────────────────────┘                     │
│               │ MCP Protocol                                   │
│       ┌───────┼───────┬───────┬───────┬───────┐               │
│       ▼       ▼       ▼       ▼       ▼       ▼               │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐      │
│  │ NPS  │ │ NTS  │ │KOSIS │ │골목   │ │부동산│ │ FSC  │      │
│  │사업장│ │사업자│ │인구  │ │상권   │ │시세  │ │재무  │      │
│  │MCP   │ │MCP   │ │MCP   │ │MCP   │ │MCP   │ │MCP   │      │
│  └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘ └──┬───┘      │
│     │        │        │        │        │        │            │
│     └────────┴────────┴────┬───┴────────┴────────┘            │
│                            │                                   │
│                    data.go.kr APIs                             │
│                                                                │
└──────────────────────────────────────────────────────────────┘
```

#### MCP 도구 목록 (Phase 3)

| MCP 서버 | 도구 | 설명 | 출처 |
|----------|------|------|------|
| **nps-business** | `search_business()` | 지역/업종별 사업장 검색 | data-go-mcp-servers 활용 |
| | `get_business_detail(seq)` | 직원수, 급여, 등록일 | data-go-mcp-servers 활용 |
| | `get_period_status(seq)` | 월별 취득/상실자 추이 | data-go-mcp-servers 활용 |
| **nts-business** | `check_business_status(b_no[])` | 3단계 상태 배치 조회 | data-go-mcp-servers 활용 |
| | `validate_business(b_no)` | 사업자 진위 확인 | data-go-mcp-servers 활용 |
| **kosis-population** | `get_population(region)` | 인구/세대 통계 | 자체 MCP 래핑 필요 |
| | `get_migration(region)` | 인구 이동 추이 | 자체 MCP 래핑 필요 |
| **golmok-market** | `get_market_analysis(code)` | 골목상권 매출/변화 | 자체 MCP 래핑 필요 |
| **real-estate** | `get_rent_price(region)` | 실거래 임대료 | 자체 MCP 래핑 필요 |
| **fsc-financial** | `get_income_statement(crno)` | 법인 손익계산서 | data-go-mcp-servers 활용 |

---

### 수익 모델 (Phase 3)

| 플랜 | 가격 | 포함 내용 |
|------|------|----------|
| **Light** (기존) | ₩9,900/월 | 10건 정형 분석 (Phase 2 방식) |
| **Pro** (기존) | ₩19,900/월 | 무제한 정형 분석 + AI 리포트 전문 |
| **Consultant** (신규) | ₩49,900/월 | Pro 전체 + AI 자유 질문 50회/월 |
| **Enterprise** (신규) | 별도 협의 | 무제한 AI 컨설팅 + 맞춤 분석 + API 접근 |

**AI 컨설턴트 모드 원가 추정:**
```
Claude Sonnet 1회 대화 (평균 3회 도구 호출):
  Input: ~4,000 tokens × $3/M = $0.012
  Output: ~1,500 tokens × $15/M = $0.0225
  합계: ~$0.035/회 ≈ ₩50/회

50회/월 × ₩50 = ₩2,500 → 마진 ₩47,400 (95%)
```

---

### Phase 3 로드맵 (예정)

| 단계 | 기간 | 내용 | 전제 조건 |
|------|------|------|----------|
| **3-A** | 4주 | MCP 서버 구축 (NPS, NTS, KOSIS, 골목상권) | Phase 2 완료, data-go-mcp-servers 포크 |
| **3-B** | 4주 | AI 에이전트 엔진 (Claude Sonnet + MCP 연동) | MCP 서버 안정화, Anthropic Tool Use API |
| **3-C** | 4주 | 대화형 UI + 프리미엄 결제 | 에이전트 정확도 90%+, 응답 시간 <10초 |
| **3-D** | 2주 | 베타 테스트 + 정식 출시 | Consultant 플랜 결제 연동 |

**Phase 3 시작 조건:**
- Phase 2 정형 분석 MAU 5,000+ 달성
- Pro 플랜 전환율 5%+ 확보
- Claude Sonnet Tool Use API 안정성 검증

---

### MCP 연동 vs 직접 API: 판단 기준 정리

| 기준 | 직접 API (Phase 2) | MCP (Phase 3) |
|------|-------------------|---------------|
| **분석 유형** | 정형 (고정 5지표) | 탐색형 (자유 질문) |
| **점수 산출** | 결정적 공식 | AI 판단 기반 |
| **응답 속도** | 3-5초 | 5-15초 |
| **비용/건** | ₩50 (API만) | ₩100 (API + AI) |
| **사용자 기대** | 일관된 점수 | 맞춤형 인사이트 |
| **기술 스택** | TypeScript 직접 호출 | Python MCP + Claude Agent |
| **적합 플랜** | Free ~ Pro | Consultant ~ Enterprise |

---

## 🎯 결론 및 다음 단계

### Phase 2 완료 후 예상 효과

1. **사용자 경험**
   - 분석 완료 시간: 3분 → 2분 30초 (15% 개선)
   - 모바일 사용자 만족도: 3.5 → 4.2/5
   - 재방문율: 30% → 40%

2. **비즈니스**
   - 월 분석 요청: 10만 → 14만 (+40%)
   - 프리미엄 전환: 신규 수익 창출
   - 시장 점유율: 모바일 창업 분석 1위 지향

3. **기술**
   - 모바일 최적화 완료 (PWA, 오프라인 지원)
   - 성능 개선 (FCP 3초 이내, LCP 2.5초 이내)
   - 스케일러빌리티 확보 (월 500만 요청 처리)

### 전체 로드맵 프리뷰

```
Phase 2.1 (4주):
├─ 트렌드 알림 + 매출 시뮬레이션
└─ 네이티브 앱 검토 (React Native 또는 Flutter)

Phase 2.2 (4주):
├─ KOSIS 인구이동/연령 분석 파이프라인
└─ 커뮤니티 기능 (창업자 네트워크)

Phase 3 — AI 컨설턴트 모드 (14주): ← NEW
├─ Phase 3-A: MCP 서버 구축 (NPS, NTS, KOSIS, 골목상권)
├─ Phase 3-B: AI 에이전트 엔진 (Claude Sonnet + MCP Tool Use)
├─ Phase 3-C: 대화형 UI + Consultant 플랜 결제
└─ Phase 3-D: 베타 테스트 + 정식 출시
  → 전제: Phase 2 MAU 5,000+, Pro 전환율 5%+
  → 수익: Consultant ₩49,900/월, Enterprise 별도 협의

※ 상세 내용은 "Phase 3 비전: AI 컨설턴트 모드" 섹션 참조
```

---

## 📚 부록

### A. 용어 정의 (Glossary)

| 용어 | 정의 |
|------|------|
| **상권 활력도** | 특정 지역의 유동인구, 매출액 등으로 측정한 시장 활성도 |
| **경쟁 강도** | 반경 내 동종 업종 경쟁사의 개수와 시장 점유도 |
| **입지 적합성** | 선택한 업종의 특성과 지역의 특성의 부합도 |
| **생존율** | 창업 후 1년, 2년, 5년 동안 지속된 사업의 비율 |
| **주거 밀도** | 특정 지역의 인구 밀도와 거주자 수 |
| **소득 수준** | 지역 주민의 평균 소득과 소비력 |
| **마이크로 인터랙션** | 작은 범위의 사용자 상호작용에 대한 피드백 (진동, 음성, 애니메이션) |
| **Haptic Feedback** | 터치 화면의 진동이나 힘 피드백 |
| **PWA** | 웹 기술로 만든 앱 같은 웹 애플리케이션 |
| **Feature Flag** | 특정 기능을 활성/비활성화하는 토글 메커니즘 |

### B. 개발 환경 세팅 가이드

```bash
# Node.js 18+, npm 9+ 또는 pnpm 8+ 필수

# 1. 프로젝트 클론 및 의존성 설치
git clone <repository>
cd startup-analyzer-phase2
pnpm install

# 2. 환경 변수 설정
cp .env.example .env.local
# NEXT_PUBLIC_KAKAO_API_KEY=your_key
# NPS_API_KEY=your_nps_key
# NTS_API_KEY=your_nts_key          ← Phase 2 신규: 국세청 사업자상태조회
# KOSIS_API_KEY=your_kosis_key
# DATABASE_URL=your_db_url

# 3. 개발 서버 시작
pnpm dev
# http://localhost:3000

# 4. 모바일 테스트
# localhost:3000에 접속 (모바일 기기 또는 에뮬레이터)
# 또는 ngrok를 통한 외부 접근

# 5. 빌드
pnpm build
pnpm start
```

### C. 테스트 체크리스트

#### 기능 테스트

```
[ ] Step 1: 온보딩 화면 로드 및 버튼 클릭
[ ] Step 2-3: 지도 로드 및 위치 검색
[ ] Step 4: 위치 확정 및 지도 이동 (애니메이션)
[ ] Step 5: 반경 조정 (슬라이더 + 스와이프)
  [ ] 경쟁업체 마커 실시간 업데이트
  [ ] 경쟁업체 수 카운트 정확성
[ ] Step 6: 업종 선택 및 미리보기
[ ] Step 7: 분석 결과 요약 (애니메이션)
[ ] Step 8: AI 리포트 조회 및 탭 전환
```

#### 반응형 테스트

```
[ ] iPhone SE (375px 너비)
[ ] iPhone 12/13 (390px)
[ ] iPhone 14 Pro Max (430px)
[ ] Samsung Galaxy S21 (360px)
[ ] iPad (768px 이상)
[ ] 세로/가로 방향 전환
[ ] 상태바, 네비게이션 바 보임 상태
```

#### 성능 테스트

```
[ ] Lighthouse Score 85+ (Desktop)
[ ] Lighthouse Score 80+ (Mobile)
[ ] FCP < 3초
[ ] LCP < 2.5초
[ ] CLS < 0.1
[ ] 초기 번들 크기 < 200KB (gzipped)
[ ] 반경 업데이트 응답 < 500ms
```

#### 접근성 테스트

```
[ ] 스크린리더 (VoiceOver, TalkBack) 호환성
[ ] 색상 명도비 AAA (4.5:1 이상)
[ ] 터치 영역 최소 44×44px
[ ] 키보드만으로 네비게이션 가능
[ ] 초점 표시 명확
```

---

## 📞 문의 및 지원

**질문이나 의견이 있으신가요?**

- 📧 Email: product@example.com
- 💬 Slack: #product-phase2
- 📅 Weekly Sync: 월요일 10:00 AM

---

**문서 버전 이력**

| 버전 | 날짜 | 변경사항 |
|------|------|--------|
| v2.0.0 | 2026-02-09 | 최초 작성 및 완성 |
| v2.1.0 | 2026-02-09 | 스코어링 모델 개선 + AI 프롬프트 개선 섹션 추가 |
| v2.2.0 | 2026-02-09 | NTS 3단계 상태 API 연동, API 호출 49→30 최적화, Phase 3 AI 컨설턴트 모드 비전 추가 |

---

**승인 (Approval)**

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| Product Manager | TBD | ✓ | - |
| Engineering Lead | TBD | ✓ | - |
| Design Lead | TBD | ✓ | - |
| CEO | TBD | ✓ | - |

---

**© 2026 소상공인 창업 분석기 (Small Business Startup Analyzer). All rights reserved.**