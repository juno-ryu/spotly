# Next Phase 백로그

현재 단계에서 스킵했지만, 이후 페이즈에서 구현할 항목들.

---

## 1. 경쟁업체 마커 45개 제한 해제

- **현황**: Kakao Places `keywordSearch` API가 총 결과 수 **45개 하드 리밋** (size × page ≤ 45)
- **영향**: 반경이 넓거나 밀집 상권에서 실제 경쟁업체가 45개 이상이어도 45개만 표시됨
- **해결 방안**: 반경을 사분면(또는 격자)으로 분할 → 각 영역별 검색 → 중복 제거(`place.id` 기준)
  - 예: 1.5km를 4사분면으로 분할 → 최대 45 × 4 = 180개 (중복 제거 후)
  - 격자 크기를 동적으로 조정하면 더 많은 결과 가능
- **관련 파일**: `src/features/map/hooks/use-nearby-places.ts`

---

## 2. Redis 캐시 재도입

- **현황**: Redis(Upstash) 캐시를 일단 제거함. 현재 모든 API 호출이 매번 외부 API 직접 호출.
- **제거한 것**:
  - `cachedFetch(key, ttl, fetcher)` 래퍼 — `/radius` 서버 컴포넌트, `data-aggregator.ts` 등에서 사용하던 것
  - `/api/prefetch/region` 라우트 — `/map` 스텝에서 법정동코드 변경 시 추측성 프리페치
  - `use-prefetch.ts` 훅 — 프리페치 API 호출 클라이언트 훅
- **재도입 시 고려사항**:
  - `/radius` 서버 컴포넌트에서 NPS + 부동산 + KOSIS 3개 API 병렬 호출 → Redis 캐시 적용
  - `/api/analyze`에서 `aggregateAnalysisData()` 호출 시 동일 API 재호출 → 캐시 히트로 즉시 완료
  - 프리페치 타이밍: `/map`에서 추측성 프리페치 vs "여기서 분석하기" 클릭 시점에만
  - TTL 전략: NPS(24h), 부동산(24h), KOSIS(7d), 골목상권(24h)
- **관련 파일**:
  - `src/server/cache/redis.ts` — cachedFetch, CACHE_TTL (파일은 남아있음, import만 제거)
  - `src/features/analysis/lib/data-aggregator.ts` — 직접 호출로 변경됨
  - `src/app/(main)/radius/page.tsx` — 직접 호출로 변경됨

---

## 3. 서울시 골목상권 데이터 보정

- **현황**: 서울시 열린데이터광장 골목상권 API(매출추정, 점포현황, 변화지표) 3종 연동 코드는 남아있으나, 골목상권 프리페치 라우트는 삭제됨
- **제거한 것**:
  - `/api/prefetch/golmok-index/route.ts` — 골목상권 변화지표 프리페치
  - `/api/prefetch/golmok-industry/route.ts` — 골목상권 업종별 프리페치
  - `/api/prefetch/region-detail/route.ts` — 지역 상세 프리페치
- **남아있는 것**:
  - `src/server/data-sources/seoul-golmok-client.ts` — 서울시 골목상권 API 클라이언트
  - `data-aggregator.ts`에서 `isSeoul` 판별 후 골목상권 3개 API 호출 로직 (직접 호출로 변경됨)
- **향후 작업**:
  - 서울 지역 분석 시 스코어링에 골목상권 데이터 반영 (현재 수집만 하고 스코어에 미반영)
  - 전국 서비스 vs 서울 보정의 가중치 설계

---

## 4. NPS 데이터 동(읍면동) 단위 타겟팅

- **현황**: NPS API는 시군구(5자리 법정동코드) 단위까지만 검색 파라미터 지원. 읍면동 코드(`ldongAddrMgplSgguEmdCd`)는 응답에만 포함.
- **문제**: 시군구 전체 데이터가 와서 반경 내 사업장이 거의 없음. 현재 NPS는 분석용으로만 사용하고 마커는 카카오 Places로 표시.
- **해결 방안**:
  - 응답의 읍면동 코드로 후필터링 (API 제약 내에서 가능한 최선)
  - 키워드(`wkplNm`) 없이 전체 사업장 조회 → 페이지네이션 → 거리 필터링 (API 호출량 증가)
  - NPS 좌표 데이터가 없는 근본적 한계는 Kakao Geocoder로 보완 (클라이언트 지오코딩)

---

## 5. 카드 매출 데이터 연동

- **필요성**: 현재 NPS(국민연금) + 부동산 간접 추정만으로는 실제 매출 규모를 알 수 없음. 경쟁사 오픈업은 카드 매출 데이터 기반 매출 추정을 무료 제공 중 — 데이터 신뢰도에서 가장 큰 격차.
- **확보 경로 (난이도순)**:
  1. **Tier 1 — 공공 데이터 (무료, 즉시 가능)**
     - 경기데이터드림: 경기도 카드소비 통계 API (`card.gyeonggi.go.kr`)
     - 서울빅데이터캠퍼스: 서울시 카드 매출 데이터 (신청 후 반출)
     - 소상공인시장진흥공단: 상권정보 API 내 업종별 평균 매출 추정치
     - **한계**: 지역 제한(서울/경기), 집계 단위가 크고 개별 점포 단위 아님
  2. **Tier 2 — 데이터 거래소 (유료, 1~2주)**
     - 금융데이터거래소 (credb.kcredit.or.kr): 업종·지역별 카드 매출 통계
     - 신한 DataBada: 신한카드 가맹점 매출 데이터 API
     - Aicel (아이셀): BC카드 기반 소비 데이터
     - **비용**: 건당 과금 또는 월정액 (수십~수백만원)
  3. **Tier 3 — 카드사 직접 제휴 (무료~유료, 1~3개월)**
     - BC카드: 뤼튼(AI 스타트업)과 제휴 선례 있음 — 스타트업도 가능하다는 증거
     - 비씨카드 ISP API, 삼성카드 오픈API 등
     - **접근법**: 사업 제안서 + 데이터 활용 계획서 제출 → 심사 → MOU
  4. **Tier 4 — 마이데이터 사업자 (장기)**
     - 금융위 마이데이터 사업자 등록 후 개인 동의 기반 카드 내역 수집
     - **현실**: 등록 절차 6개월+, 자본금 요건 있음. MVP 단계에서는 비현실적
- **MVP 전략**: Tier 1(공공 데이터)부터 연동하여 서울/경기 커버 → 매출 확보 후 Tier 2 유료 데이터 도입 → 사용자 규모 확보 후 Tier 3 카드사 제휴 추진
- **스코어링 반영 계획**:
  - 신규 지표 "매출 추정" 추가 또는 기존 "상권 활력도" 지표에 매출 데이터 블렌딩
  - 카드 데이터 유무에 따라 confidence score 차등 반영 (있으면 🟢, 없으면 🟡)

---

## 6. 대중교통 접근성 데이터 연동

- **필요성**: 유동인구와 상권 접근성은 직결됨. 지하철역/버스정류장 근접도 + 승하차 인원은 상권 활력도의 핵심 보조 지표.
- **활용 가능 API**:
  1. **전국 버스정류소 (TAGO, data.go.kr)**
     - 엔드포인트: `apis.data.go.kr/1613000/BusSttnInfoInqireService`
     - 좌표 기반 주변 정류장 검색 가능
     - 범위: 전국
     - 무료, 일 10,000회
  2. **지하철역 위치 정보 (서울교통공사)**
     - 서울열린데이터광장 OA-15442
     - 역명, 호선, 위경도 좌표 (WGS84)
     - 범위: 수도권 (1~9호선, 분당, 신분당 등)
  3. **지하철 승하차 인원 (서울시)**
     - 서울열린데이터광장 OA-12914
     - 시간대별 역별 승하차 인원 통계
     - 매일 갱신
     - 범위: 서울시
  4. **ODsay LAB API (민간, 전국)**
     - 좌표 기반 반경 내 버스/지하철 정류장 통합 검색
     - 대중교통 길찾기, 노선 데이터
     - 무료 플랜: 일 1,000회
     - 범위: 전국
  5. **버스 승하차 인원 (서울시 교통카드 이용정보)**
     - 노선별 정류소별 승하차 인원
     - 범위: 서울시
- **스코어링 반영 계획**:
  - 신규 보조 지표 "교통 접근성" 도입 (메인 5대 지표 배점 외 보너스 or 활력도 하위 요소)
  - 반경 내 버스정류장 수 + 지하철역 유무 + 일평균 승하차 인원 조합
  - 서울: 승하차 인원 데이터까지 활용 (고정밀)
  - 비서울: TAGO 정류장 수 + ODsay 역 유무만 활용 (기본)
- **MVP 전략**: TAGO(전국 버스) + 지하철역 위치(파일 데이터) 먼저 연동 → 승하차 인원은 서울 우선 적용 → ODsay 연동으로 전국 확대
- **관련 파일**: 신규 `src/server/data-sources/transit-client.ts` 생성 예정
